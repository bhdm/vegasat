function GF(){}function GF_Base(){return this.GF_Base,this.GF_Base=function(){try{}catch(t){return!1}},this.GF_Base()}function GF_Debug(){}function GF_Exception(t){}function GF_Config(t){return this.GF_Config=function(t){},this._Process=function(t){this._ProcessNode(t,this),this._PostProcess()},this._ProcessNode=function(t,e){for(var i in t)!(t[i]instanceof Object)||t[i]instanceof Function||t[i]instanceof Array||t[i]instanceof $?void 0!=e[i]?e[i]=t[i]:GF_Debug.Warning("Encountered an attempt to override a non-existing parameter ("+i+") in a GF_Config derived class."):void 0!=e[i]?0==GF.CountMembers(e[i])?e[i]=t[i]:this._ProcessNode(t[i],e[i]):GF_Debug.Warning("Encountered an attempt to override a non-existing parameter group ("+i+") in a GF_Config derived class.")},this._PostProcess=function(){},this.GF_Config(t)}function GF_Instance(sType,jTarget,oOptions){return this.m_iId,this.m_jTarget,this.m_sType,this.GF_Instance,this.InitInstance,this.RemoveInstance,this.RefreshTarget,this.IsInstanceOf,this.GF_Instance=function(sType,jTarget,options){try{if(void 0!=sType&&sType||GF_Debug.Error("No instance type specified. GF object creation failed."),this.m_sType=sType,jTarget instanceof $||GF_Debug.Error("Unknown type of target ("+typeof jTarget+"). Expected a jQuery object. GF object creation failed."),jTarget.length<1)return GF_Debug.Warning("Target emerged to be an empty jQuery object. GF object creation omitted."),!1;if(jTarget.length>1){var a=[];eval("var f = "+sType+";");for(var i=0;i<jTarget.length;i++)a.push(new f(jTarget.eq(i),oOptions));return a}this.InitInstance(jTarget)}catch(xException){return GF_Debug.HandleException(xException),this.RemoveInstance(),!1}},this.InitInstance=function(t){this.m_iId=GF_Instance.s_aoInstances.push(this)-1,this.m_jTarget=t,this.m_jTarget.addClass("GF-instance-"+this.m_iId).addClass("GF-instance").addClass(sType)},this.RemoveInstance=function(){void 0!=this.m_iId&&void 0!=GF_Instance.s_aoInstances[this.m_iId]&&(this.m_jTarget&&this.m_jTarget.remove(),GF.DeleteFromArray(GF_Instance.s_aoInstances,this.m_iId))},this.RefreshTarget=function(){this.m_jTarget=$(".GF-instance-"+this.m_iId)},this.IsInstanceOf=function(t){return this.m_sType==t},this.GF_Instance(sType,jTarget,oOptions)}function GF_Alert(t,e,i,s,a,n){this.m_sTitle=t,this.m_sMessage=e,this.m_cOk=i,this.m_cCancel=s,this.m_mParamOk=a,this.m_mParamCancel=n,this.m_iId=GF_Alert.instances.push(this)-1,this.create=function(){if(this.m_cOk instanceof Function)var t=this.m_mParamOk,e=this.m_cOk,i=function(i){e(t),GAlert.DestroyThis.apply($(this).closest(".message").get(0))};else var i=GAlert.DestroyThis;if(this.m_cCancel instanceof Function)var s=this.m_mParamCancel,a=this.m_cCancel,n=function(t){a(s),GAlert.DestroyThis.apply($(this).closest(".message").get(0))};else var n=GAlert.DestroyThis;return this.m_cOk&&this.m_cCancel?void GWarning(this.m_sTitle,this.m_sMessage,{bAutoExpand:!0,aoPossibilities:[{mLink:i,sCaption:GF_Alert.Language.ok},{mLink:n,sCaption:GF_Alert.Language.cancel}]}):this.m_cOk?void GWarning(this.m_sTitle,this.m_sMessage,{bAutoExpand:!0,aoPossibilities:[{mLink:i,sCaption:GF_Alert.Language.ok}]}):void GWarning(this.m_sTitle,this.m_sMessage)},this.close=function(){$("#alert-"+this.m_iId).remove();var t=0;for(var e in GF_Alert.instances)void 0!=GF_Alert.instances[e]&&t++;1>=t&&($("#alert-overlay").unbind("keydown",GF_Alert.KeyPressed),$("#alert-overlay").fadeOut("fast",function(){}))},this.create()}GF.NULL=-9999,GF.ExtendClass=function(t,e,i,s){var a=this,n=function(){for(var i=[t],n=0;n<arguments.length;n++)i.push(arguments[n]);if(void 0!=s&&s)return e.apply(this,arguments);var o=a.apply(this,i);return o===!1?o:e.apply(this,arguments)};return n.GF_ImplementMembers(a.prototype),n.GF_ImplementStaticMembers(a,t),n.GF_ImplementStaticMembers(i),n},GF.ImplementMembers=function(t){for(var e in t)this.prototype[e]=t[e]},GF.ImplementStaticMembers=function(t,e){for(var i in t)"GetInstance"==i?this[i]=function(t){return GF_Instance.GetInstance(t,e)}:"GetCurrentInstance"==i?this[i]=function(t){return GF_Instance.GetCurrentInstance(t,e)}:this[i]=t[i]},GF.NewConstructor=function(t){var e=function(e,i){try{return t.apply(this,arguments)}catch(s){return GF_Debug.HandleException(s),this.RemoveInstance(),!1}};return e},GF.NewEventHandler=function(t){var e=function(e){try{return t.apply(this,arguments)}catch(i){return GF_Debug.HandleException(i),!1}};return e},GF.NewSafeMethod=function(t){var e=function(e){try{return t.apply(this,arguments)}catch(i){return GF_Debug.HandleException(i),!1}};return e},GF.GetClasses=function(t){return t.attr("class").split(" ")},GF.GetChunkFromClass=function(t,e){var i=GF.GetClasses(t);for(var s in i)if(i[s].substr(0,e.length)==e)return i[s].substr(e.length);return GF_Debug.Warning("Desired string ("+e+") was not found in any of the node's classes (class string: \""+t.attr("class")+'").'),""},GF.GetIdFromFieldName=function(t){var e=t.match(/\[[^\]]+\]/g),i=e.pop();return i.substr(1,i.length-2)},GF.CheckboxesCheck=function(t){t.checkCheckboxes()},GF.CheckboxesUncheck=function(t){t.unCheckCheckboxes()},GF.StopPropagation=function(t){return t.stopImmediatePropagation(),t.stopPropagation(),!0},GF.PreventDefault=function(t){return t.preventDefault(),!0},GF.InArray=function(t,e){for(var i in t)if(t[i]==e)return!0;return!1},GF.DeleteFromArray=function(t,e){for(;;){var i=t.length,s=0;for(var a in t)t[a]==e&&t.splice(a,1),s++;if(s==i)break}return t},GF.DeleteFromArrayAt=function(t,e){for(;;){var i=t.length,s=0;for(var a in t)a==e&&t.splice(a,1),s++;if(s==i)break}return t},GF.Clone=function(t){if(null==t||"object"!=typeof t)return t;var e=new t.constructor;for(var i in t)e[i]=GF.Clone(t[i]);return e},GF.CountMembers=function(t){var e=0;for(var i in t)e++;return e},GF.MoneyFormat=function(t){return t.toFixed(2)},GF.ParseMoney=function(t){return parseFloat(t.replace(/,/,"."))},Function.prototype.GF_Extend=GF.ExtendClass,Function.prototype.GF_ImplementMembers=GF.ImplementMembers,Function.prototype.GF_ImplementStaticMembers=GF.ImplementStaticMembers,GF_Debug.LEVEL_ALL=0,GF_Debug.LEVEL_ERRORS_ONLY=1,GF_Debug.LEVEL_NONE=2,GF_Debug.s_iLevel=GF_Debug.LEVEL_NONE,GF_Debug.s_asMessages=[],GF_Debug.Error=function(t){throw GF_Debug.s_asMessages.push({level:2,message:t}),GF_Debug.s_iLevel<=GF_Debug.LEVEL_ERRORS_ONLY&&GF_Debug.ShowMessage(t),new GF_Exception(t)},GF_Debug.Warning=function(t){GF_Debug.s_asMessages.push({level:1,message:t}),GF_Debug.s_iLevel==GF_Debug.LEVEL_ALL&&GF_Debug.ShowMessage(t)},GF_Debug.ShowMessage=function(t){GAlert(GF_Debug.Language.error_occured,t,{iType:GAlert.TYPE_ERROR})},GF_Debug.HandleException=function(t){throw t instanceof GF_Exception||GF_Debug.level<=GF_Debug.LEVEL_ERRORS_ONLY&&alert("Non-GF exception:\n"+t),t},GF_Debug.Language={error_occured:"WystД…piЕ‚ bЕ‚Д…d!"},GF_Instance.s_aoInstances=[],GF_Instance.GetInstance=function(t,e){var i;if(t.hasClass("GF-instance")&&(void 0==e||t.hasClass(e))){if(i=GF_Instance.GetId(GF.GetClasses(t)),i>=0)return GF_Instance.ReturnInstance(i);GF_Debug.Message("Encoutered a .GF-instance node without id.")}for(var s=t.parents(".GF-instance"+(void 0==e?"":"."+e)),a=0;a<s.length;a++){if(t=s.eq(a),i=GF_Instance.GetId(GF.GetClasses(t)),i>=0)return GF_Instance.ReturnInstance(i);GF_Debug.Message("Encoutered a .GF-instance node without id.")}return GF_Debug.Error("Instance not found!"),!1},GF_Instance.GetId=function(t){for(var e in t)if("GF-instance-"==t[e].substr(0,12))return t[e].substr(12);return-1},GF_Instance.ReturnInstance=function(t){return void 0==GF_Instance.s_aoInstances[t]?(GF_Debug.Error("Tried to access a non-existing instance ("+t+")."),!1):GF_Instance.s_aoInstances[t]},GF_Instance.GetCurrentInstance=function(mContext,sType){return eval("var bIsProperType = ((mContext instanceof "+sType+") ? true : false);"),bIsProperType?mContext:void 0!=mContext.nodeType?(eval("var instance = "+sType+".GetInstance($(mContext));"),instance):(GF_Debug.Error("Couldn't get current instance of type "+sType+". Unrecognized context type ("+typeof mContext+")"),!1)},GF_Autosuggest=GF_Instance.GF_Extend("GF_Autosuggest",function(t,e){return this.m_sName,this.m_fSource,this.m_iMinLength=3,this.m_iDelay=500,this.m_iMaxSuggestions=5,this.m_jInput,this.m_aSuggestions=[],this.m_iCurrentSuggestion=0,this.m_bPending=!1,this.GF_Autosuggest,this.InitializeEvents,this.FocusInput,this.BlurInput,this.ClickedInput,this.ChangeActiveSuggestion,this.SuggestionChosen,this.KeyDown,this.KeyPressed,this.LoadSuggestions,this.ShowSuggestions,this.CreateSuggestions,this.DeleteSuggestions,this.ExpandSuggestions,this.RetractSuggestions,this.GF_Autosuggest=GF.NewConstructor(function(t,e){this.m_jInput=this.m_jTarget.find("input"),this.m_sName=this.m_jInput.attr("name"),this.m_fSource=e.source,this.m_iMinLength=void 0!=e.minLength?e.minLength:this.m_iMinLength,this.m_iDelay=void 0!=e.delay?e.delay:this.m_iDelay,this.m_iMaxSuggestions=void 0!=e.maxSuggestions?e.maxSuggestions:this.m_iMaxSuggestions,this.InitializeEvents()}),this.InitializeEvents=function(){this.m_jInput.blur(this.BlurInput).focus(this.FocusInput).click(this.ClickedInput).keypress(this.KeyPressed).keydown(this.KeyDown),$("#auto_suggest-suggestions li").live("click",this.SuggestionChosen).live("mouseover",this.ChangeActiveSuggestion)},this.FocusInput=GF.NewEventHandler(function(t){var e=GF_Autosuggest.GetCurrentInstance(this);return e.m_jInput.attr("name",e.m_sName+"_"+Math.floor(1e6*Math.random())),GF_Autosuggest.active=e.m_iId,GF_Autosuggest.enabled?(GF_Autosuggest.GetSuggestions(),!0):(GF_Autosuggest.enabled=!0,!0)}),this.BlurInput=GF.NewEventHandler(function(t){var e=GF_Autosuggest.GetCurrentInstance(this);return e.m_jInput.attr("name",e.m_sName),GF_Autosuggest.last=GF_Autosuggest.active,GF_Autosuggest.active=-1,e.RetractSuggestions(),!0}),this.ClickedInput=GF.NewEventHandler(function(t){return GF_Autosuggest.suggestions instanceof jQuery&&GF_Autosuggest.suggestions.length||GF_Autosuggest.GetSuggestions(),!0}),this.ChangeActiveSuggestion=GF.NewEventHandler(function(t){if(this instanceof GF_Autosuggest){var e=this;e.m_iCurrentSuggestion=t}else{var e=GF_Autosuggest.ReturnInstance(GF_Autosuggest.active);e.m_iCurrentSuggestion=$("#auto_suggest-suggestions li").index(this)}return $("#auto_suggest-suggestions li").removeClass("active"),$("#auto_suggest-suggestions li:eq("+e.m_iCurrentSuggestion+")").addClass("active"),!0}),this.SuggestionChosen=GF.NewEventHandler(function(t){if(GF_Autosuggest.active>=0)var e=GF_Autosuggest.ReturnInstance(GF_Autosuggest.active);else{if(!(GF_Autosuggest.last>=0))return!0;var e=GF_Autosuggest.ReturnInstance(GF_Autosuggest.last)}return e.m_jInput.val($("#auto_suggest-suggestions li:eq("+e.m_iCurrentSuggestion+")").text()).change(),GF_Autosuggest.enabled=!1,e.m_jInput.focus(),!0}),this.KeyDown=GF.NewEventHandler(function(t){switch(t.keyCode){case 38:if(!(GF_Autosuggest.suggestions instanceof jQuery&&GF_Autosuggest.suggestions.length))return!1;var e=GF_Autosuggest.ReturnInstance(GF_Autosuggest.active);return e.ChangeActiveSuggestion(Math.max(0,e.m_iCurrentSuggestion-1)),!1;case 40:if(!(GF_Autosuggest.suggestions instanceof jQuery&&GF_Autosuggest.suggestions.length))return GF_Autosuggest.GetSuggestions(),!1;var e=GF_Autosuggest.ReturnInstance(GF_Autosuggest.active);return e.ChangeActiveSuggestion(Math.min(e.m_aSuggestions.length-1,e.m_iCurrentSuggestion+1)),!1;case 13:if(!(GF_Autosuggest.suggestions instanceof jQuery&&GF_Autosuggest.suggestions.length))return!0;var e=GF_Autosuggest.ReturnInstance(GF_Autosuggest.active);return e.SuggestionChosen(),e.RetractSuggestions(),!1;case 27:if(!(GF_Autosuggest.suggestions instanceof jQuery&&GF_Autosuggest.suggestions.length))return!0;var e=GF_Autosuggest.ReturnInstance(GF_Autosuggest.active);return e.RetractSuggestions(),!1}if(window.opera||8==t.keyCode||46==t.keyCode){var e=GF_Autosuggest.ReturnInstance(GF_Autosuggest.active);return e.pending||setTimeout(GF_Autosuggest.GetSuggestions,e.m_iDelay),!0}}),this.KeyPressed=GF.NewEventHandler(function(t){if(13==t.keyCode){if(!(GF_Autosuggest.suggestions instanceof jQuery&&GF_Autosuggest.suggestions.length))return!0;var e=GF_Autosuggest.ReturnInstance(GF_Autosuggest.active);return e.SuggestionChosen(),e.RetractSuggestions(),!1}if(t.charCode){var e=GF_Autosuggest.ReturnInstance(GF_Autosuggest.active);return e.pending||setTimeout(GF_Autosuggest.GetSuggestions,e.m_iDelay),!0}}),this.LoadSuggestions=function(t){this.m_aSuggestions=t.s,this.m_aSuggestions.length&&GF_Autosuggest.active>=0&&this.m_jInput.val()==t.q?(this.ExpandSuggestions(),this.ShowSuggestions()):this.RetractSuggestions()},this.ShowSuggestions=function(){this.m_iCurrentSuggestion=0;var t=GF_Autosuggest.suggestions.find("ul");t.empty();for(var e in this.m_aSuggestions)t.append("<li"+(e==this.m_iCurrentSuggestion?' class="active"':"")+">"+this.m_aSuggestions[e].name+"</li>")},this.CreateSuggestions=function(){GF_Autosuggest.suggestions=$('<div id="auto_suggest-suggestions"></div>'),GF_Autosuggest.suggestions.append('<div class="ne"></div>'),GF_Autosuggest.suggestions.append('<div class="nw"></div>'),GF_Autosuggest.suggestions.append('<div class="se"></div>'),GF_Autosuggest.suggestions.append('<div class="sw"></div>'),GF_Autosuggest.suggestions.append("<ul></ul>"),GF_Autosuggest.suggestions.css("display","none"),$("body").append(GF_Autosuggest.suggestions)},this.DeleteSuggestions=function(){GF_Autosuggest.suggestions instanceof jQuery&&GF_Autosuggest.suggestions.length&&GF_Autosuggest.suggestions.remove(),GF_Autosuggest.suggestions=GF.NULL},this.ExpandSuggestions=function(){var t=GF_Autosuggest.GetCurrentInstance(this);GF_Autosuggest.suggestions instanceof jQuery&&GF_Autosuggest.suggestions.length||(t.CreateSuggestions(),GF_Autosuggest.suggestions.css("width",t.m_jInput.width()+12),GF_Autosuggest.suggestions.css("left",t.m_jInput.offset().left-1),GF_Autosuggest.suggestions.css("top",t.m_jInput.offset().top+t.m_jInput.height()+14),GF_Autosuggest.suggestions.fadeIn(200))},this.RetractSuggestions=function(){if(GF_Autosuggest.suggestions instanceof jQuery&&GF_Autosuggest.suggestions.length){var t=GF_Autosuggest.GetCurrentInstance(this);GF_Autosuggest.suggestions.fadeOut(200,t.DeleteSuggestions)}},this.GF_Autosuggest(t,e)},{enabled:!0,active:-1,last:-1,suggestions:GF.NULL,GetSuggestions:function(){if(!(GF_Autosuggest.active<0)){var t=GF_Autosuggest.ReturnInstance(GF_Autosuggest.active),e=t.m_jInput.val();return e.length<t.m_iMinLength?void t.RetractSuggestions():void(t.pending||(t.pending=!0,t.m_fSource({id:t.m_iId,q:e,n:t.m_iMaxSuggestions},"GF_Autosuggest.ProcessSuggestions")))}},ProcessSuggestions:function(t){if(void 0!=GF_Autosuggest.ReturnInstance(t.id)){var e=GF_Autosuggest.ReturnInstance(t.id);e.pending=!1,e.LoadSuggestions(t),t.q!=e.m_jInput.val()&&GF_Autosuggest.GetSuggestions()}}}),GF_Autosuggest.Language={},GF_ConflictResolver=GF_Instance.GF_Extend("GF_ConflictResolver",function(t,e){return this.m_fUpdateFunction,this.m_fRetryFunction,this.m_fCancelFunction,this.m_aConflictGroups,this.GF_ConflictResolver,this.Update,this.Cancel,this.Retry,this.Rewrite,this._ProcessData,this.GF_ConflictResolver=GF.NewConstructor(function(t,e){GF_ConflictResolver.s_dInstance=this,this.m_fUpdateFunction=e.update_function,this.m_fRetryFunction=e.retry_function,this.m_fCancelFunction=e.cancel_function,this.m_aConflictGroups=[],this.Update()}),this.Update=GF.NewEventHandler(function(){this.m_fUpdateFunction({id:this.m_iId},"GF_ConflictResolver.ProcessIncomingData")}),this._ProcessData=function(t){this.m_aConflictGroups=t.conflict_groups,this.Rewrite()},this.Retry=GF.NewEventHandler(function(t){var e=GF_ConflictResolver.GetMain();return void 0!=e.m_aConflictGroups[t.data.iGroup]?e.m_fRetryFunction({model:e.m_aConflictGroups[t.data.iGroup].model,method:e.m_aConflictGroups[t.data.iGroup].method,input:e.m_aConflictGroups[t.data.iGroup].input}):e.Update(),!1}),this.Cancel=GF.NewEventHandler(function(t){var e=GF_ConflictResolver.GetMain();return void 0!=e.m_aConflictGroups[t.data.iGroup]?e.m_fCancelFunction({model:e.m_aConflictGroups[t.data.iGroup].model,method:e.m_aConflictGroups[t.data.iGroup].method,input:e.m_aConflictGroups[t.data.iGroup].input}):e.Update(),!1}),this.Rewrite=GF.NewSafeMethod(function(){if(this.m_aConflictGroups.length){this.m_jTarget.empty(),this.m_jTarget.append("<h2>"+GF_ConflictResolver.Language.conflict_resolving+"</h2>"),this.m_jTarget.append("<p>"+GF_ConflictResolver.Language.conflicts_encountered+"</p>");for(var t=$("<ul></ul>"),e=0;e<this.m_aConflictGroups.length;e++){var i=$("<li></li>");i.append("<h3>Tu fajnie byloby napisac, ze user probowal wykonac taka, a nie inna operacje</h3>"),i.append($("<p></p>").append($('<a href="#">'+GF_ConflictResolver.Language.try_again+"</a>").bind("click",{iGroup:e},this.Retry))),i.append($("<p></p>").append($('<a href="#">'+GF_ConflictResolver.Language.cancel+"</a>").bind("click",{iGroup:e},this.Cancel)));var s=$("<ul></ul>");for(var a in this.m_aConflictGroups[e].tables){var n=$("<li></li>");n.append("<h4>"+this.m_aConflictGroups[e].tables[a].message+"</h4>"),n.append($('<p><a href="/admin/'+this.m_aConflictGroups[e].tables[a].controller+'">'+GF_ConflictResolver.Language.go_to_controller+"</a></p>"));for(var o=$("<ul></ul>"),r=0;r<this.m_aConflictGroups[e].tables[a].conflicts;r++){var _=$("<li></li>");for(var d in this.m_aConflictGroups[e].tables[a].columns)_.append(this.m_aConflictGroups[e].tables[a].columns[d].values[r]+" ");o.append(_)}n.append(o),s.append(n)}i.append(s),t.append(i)}this.m_jTarget.append(t),this.m_jTarget.slideDown("fast")}else this.m_jTarget.slideUp("fast",function(){$(this).empty()})}),this.GF_ConflictResolver(t,e)},{s_dInstance:GF.NULL,GetMain:GF.NewSafeMethod(function(){return GF_ConflictResolver.s_dInstance}),ProcessIncomingData:GF.NewEventHandler(function(t){void 0!=t.id&&GF_Instance.s_aoInstances[t.id]instanceof GF_ConflictResolver||GF_Debug.Error("The server has responded with an invalid conflict resolver id ("+t.id+").");var e=GF_Instance.ReturnInstance(t.id);e._ProcessData(t)})}),GF_ConflictResolver.Language={conflict_resolving:"RozwiД…zywanie konfliktГіw",conflicts_encountered:"PrГіbowano dokonaД‡ operacji ktГіra jest niemoЕјliwa z powodu wystД…pienia konfliktГіw.",try_again:"SprГіbuj ponownie",cancel:"Anuluj operacjД™",go_to_controller:"PrzejdЕє do odpowiedniego moduЕ‚u, aby rozwiД…zaД‡ problem"},GF_Alert.KeyPressed=function(t){switch(t.which){case 13:return $("#alert-overlay").find(".alert:first .ok a").click(),t.stopImmediatePropagation(),!1;case 27:return $("#alert-overlay").find(".alert:first .cancel a").length?$("#alert-overlay").find(".alert:first .cancel a").click():$("#alert-overlay").find(".alert:first .ok a").click(),t.stopImmediatePropagation(),!1}return!0},GF_Alert.instances=new Array,GF_Alert.Language={ok:"OK",cancel:"Anuluj"},GF_ContextMenu=GF_Instance.GF_Extend("GF_ContextMenu",function(t,e){return this.m_oOptions,this.m_bActive,this.m_cSup,this.m_cSub,this.GF_ContextMenu,this.Show,this.Hide,this.Close,this._CloseOther,this._CreateContextMenu,this._WriteAction,this.GF_ContextMenu=GF.NewConstructor(function(t,e){this.m_bActive=!1,this.m_oOptions=new GF_ContextMenu_Config(e),this._CreateContextMenu(),this.Show()}),this._CloseOther=function(){for(var t=$(".GF_ContextMenu"),e=0;e<t.length;e++)GF_ContextMenu.GetInstance(t.eq(e)).Close()},this._CreateContextMenu=function(){var t=this.m_jTarget;t.append('<div class="w"></div>'),t.append('<div class="nw"></div>'),t.append('<div class="sw"></div>'),t.append('<div class="s"></div>'),t.append('<div class="se"></div>'),t.addClass("GF_ContextMenu"),t.css("display","none");var e=$("<ul></ul>");for(var i in this.m_oOptions.actions){var s=this.m_oOptions.actions[i];e.append(this._WriteAction(s,this.m_oOptions.id))}t.mouseout(this.Hide),t.append(e),t.css("left",this.m_oOptions.position.left).css("top",this.m_oOptions.position.top)},this._WriteAction=function(t,e){var i=$("<li></li>"),s=$('<a href="#"><img src="'+t.img+'" alt=""/>'+t.caption+"</a>");if(GF.CountMembers(t.values)){var a=[];for(var n in t.values)a.push(new GF_Action({img:t.img,action:t.action,caption:t.values[n],parameter:n}));s.click(GF.NewEventHandler(function(t){var i=GF_ContextMenu.GetCurrentInstance(this),s=GF_ContextMenu.Create({id:e,actions:a,position:{left:t.pageX+9,top:t.pageY+2}});return i.m_cSub=s.m_jTarget,s.m_cSup=i,!1}))}else s.click(GF.NewEventHandler(function(i){return t.parameter!=GF.NULL?t.action(e,t.parameter):t.action(e),!1})),s.click(GF_ContextMenu.HandleHide);return i.append(s),i},this.Show=GF.NewEventHandler(function(t){var e=GF_ContextMenu.GetCurrentInstance(this);this.m_bActive=!0,GF_ContextMenu.s_iActive=this.m_iId,$("body").append(e.m_jTarget),e.m_jTarget.fadeIn(200)}),this.Hide=GF.NewEventHandler(function(t){var e=GF_ContextMenu.GetCurrent();try{var i=$(t.relatedTarget)}catch(s){return!0}return!e||!e.m_jTarget.length||i.parents(".GF_ContextMenu").length||i.hasClass("spacer")||-1!=i.parents().index(e.m_oOptions.parent)||e.m_cSub&&-1!=i.parents().index(e.m_cSub.m_jTarget)?!0:(e.m_cSup?GF_ContextMenu.s_iActive=e.m_cSup.m_iId:GF_ContextMenu.s_iActive=-1,e.m_jTarget.fadeOut(200,GF.NewEventHandler(function(t){$(this).remove();var e=GF_ContextMenu.GetCurrentInstance(this);e&&e.Close(t)})),!0)}),this.Close=GF.NewEventHandler(function(t){var e=GF_ContextMenu.GetCurrentInstance(this);e.m_jTarget.remove(),e.m_bActive=!1}),this.GF_ContextMenu(t,e)},{s_iActive:-1,Create:function(t){return new GF_ContextMenu($("<div></div>"),t)},HandleHide:GF.NewEventHandler(function(t){return-1==GF_ContextMenu.s_iActive?!0:GF_ContextMenu.ReturnInstance(GF_ContextMenu.s_iActive).Hide(t)}),GetCurrent:function(){try{return-1!=GF_ContextMenu.s_iActive?GF_ContextMenu.ReturnInstance(GF_ContextMenu.s_iActive):!1}catch(t){return GF_Debug.HandleException(t),!1}},HideAll:function(){try{return-1!=GF_ContextMenu.s_iActive&&(GF_ContextMenu.ReturnInstance(GF_ContextMenu.s_iActive).Close(),GF_ContextMenu.s_iActive=-1),!0}catch(t){return GF_Debug.HandleException(t),!1}}}),GF_ContextMenu_Config=GF_Config.GF_Extend("GF_ContextMenu_Config",function(t){return this.GF_ContextMenu_Config=GF.NewConstructor(function(t){this.id=GF.NULL,this.parent=GF.NULL,this.actions=[],this.position={left:0,top:0},this._Process(t)}),this._PostProcess=function(){},this.GF_ContextMenu_Config(t)}),GF_Datagrid_Data_Provider=function(t,e){return this.m_iId,this.m_oOptions,this.m_aoData,this.m_oRequest,this.m_aoLastFilter,this.m_sResponseHandler,this.GF_Datagrid_Data_Provider,this.Load,this.GF_Datagrid_Data_Provider=GF.NewConstructor(function(t,e){this.m_iId=GF_Datagrid_Data_Provider.s_adProviders.push(this)-1,this.m_oOptions=t,this.m_aoData=e,this._ProcessAllRows()}),this.GetData=function(){return this.m_aoData},this.Load=function(t,e){this.m_sResponseHandler=e,isNaN(t.starting_from)&&(t.starting_from=0),this.m_oRequest&&(this.m_aoLastFilter=this.m_oRequest.where),this.m_oRequest=t,void 0!=this.m_oOptions.event_handlers&&void 0!=this.m_oOptions.event_handlers.filter_change&&this.m_oOptions.event_handlers.filter_change instanceof Function&&this.m_aoLastFilter&&this._CheckIfFilterHasChanged(this.m_oRequest.where)?this.m_oOptions.event_handlers.filter_change({provider_id:this.m_iId,request:this.m_oRequest,callback:"GF_Datagrid_Data_Provider.ChangeData"}):this.ReturnData()},this.ReturnData=function(){var t=this.m_oRequest,e=this.m_aoData.slice(0),i=this._FilterData(e,t),s=this._SortData(i,t),a=this._ChunkData(s,t),n={data_id:t.id,rows_num:a.length,starting_from:t.starting_from?t.starting_from:0,total:e.length,filtered:i.length,rows:a,additional_rows:this._CalculateAdditionalRows(i)};GF_Datagrid.ProcessIncomingData(n)},this._CheckIfFilterHasChanged=function(t){if(this.m_aoLastFilter.length!=t.length)return!0;for(var e=0;e<this.m_aoLastFilter.length;e++)if(this.m_aoLastFilter[e].operator!=t[e].operator||this.m_aoLastFilter[e].value!=t[e].value)return!0;return!1},this.ChangeData=function(t){t instanceof Array?this.m_aoData=t:this.m_aoData=[],this._ProcessAllRows()},this.UpdateRow=function(t,e){for(var i in this.m_aoData)if(this.m_aoData[i][this.m_oOptions.key]==t){var s=this.m_aoData[i];return void 0!=e&&(this.m_aoData[i]=e,this.m_aoData[i]=this._ProcessRow(this.m_aoData[i]),this._InvokeEvent("row_change",{modified_row_id:t,modified_row_key:i,modified_row:this.m_aoData[i],previous_row:s,rows:this.m_aoData}),this.m_aoData[i]=this._ProcessRow(this.m_aoData[i]),this._InvokeEvent("change",{rows:this.m_aoData})),this.m_aoData[i]}GF_Debug.Error("Requested row ("+t+") was not found in the DG Data Provider when update was requested.")},this.DeleteRow=function(t){for(var e in this.m_aoData)if(this.m_aoData[e][this.m_oOptions.key]==t){var i=this.m_aoData[e];return this.m_aoData.splice(e,1),this._InvokeEvent("row_delete",{deleted_row_id:t,deleted_row_key:e,deleted_row:i,rows:this.m_aoData}),void this._InvokeEvent("change",{rows:this.m_aoData})}GF_Debug.Error("Requested row ("+t+") was not found in the DG Data Provider when deletion was requested.")},this.AddRow=function(t){t=this._ProcessRow(t);var e=t[this.m_oOptions.key];if(void 0==e)return void GF_Debug.Warning("Tried to add a row without an id in the DG Data Provider.");for(var i in this.m_aoData)if(this.m_aoData[i][this.m_oOptions.key]==e)return void GF_Debug.Warning("Tried to add a row with an identical id ("+e+") that already exists in the DG Data Provider.");var s=this.m_aoData.push(t);this._InvokeEvent("row_add",{added_row_id:e,added_row_key:s-1,added_row:t,rows:this.m_aoData}),this._InvokeEvent("change",{rows:this.m_aoData})},this.GetRow=function(t){for(var e in this.m_aoData)if(this.m_aoData[e][this.m_oOptions.key]==t)return this.m_aoData[e];GF_Debug.Warning("Requested row ("+t+") was not found in the DG Data Provider.")},this._ProcessAllRows=function(){for(var t in this.m_aoData)this.m_aoData[t]=this._ProcessRow(this.m_aoData[t])},this._ProcessRow=function(t){return this.m_oOptions.preProcess instanceof Function&&(t=this.m_oOptions.preProcess(t)),t},this._CalculateAdditionalRows=function(t){if(!this.m_oOptions.additional_rows)return[];var e=[];for(var i in this.m_oOptions.additional_rows){var s={};this.m_oOptions.additional_rows[i].source instanceof Function&&(s=this.m_oOptions.additional_rows[i].source(t)),s._options=this.m_oOptions.additional_rows[i],e.push(s)}return e},this._FilterData=function(t,e){var i=[];for(var s in t){var a=!1;for(var n in e.where){if(!e.where[n])break;var o=t[s][e.where[n].column];if(void 0!=o){switch(e.where[n].operator){case"GE":isNaN(parseFloat(o))||isNaN(parseFloat(e.where[n].value))?o<e.where[n].value&&(a=!0):parseFloat(o)<parseFloat(e.where[n].value)&&(a=!0);break;case"LE":isNaN(parseFloat(o))||isNaN(parseFloat(e.where[n].value))?o>e.where[n].value&&(a=!0):parseFloat(o)>parseFloat(e.where[n].value)&&(a=!0);break;case"LIKE":-1==o.toUpperCase().indexOf(e.where[n].value.substr(1,e.where[n].value.length-2).toUpperCase())&&(a=!0)}if(a)break}else a=!0}a||i.push(t[s])}return i},this._SortData=function(t,e){return t.sort(function(t,i){if(void 0==t[e.order_by]||void 0==i[e.order_by])return 0;if(!isNaN(parseFloat(t[e.order_by]))&&!isNaN(parseFloat(i[e.order_by])))return"asc"==e.order_dir?parseFloat(t[e.order_by])>parseFloat(i[e.order_by])?1:-1:parseFloat(t[e.order_by])>parseFloat(i[e.order_by])?-1:1;for(var s="asc"==e.order_dir?1:-1,a=0;a<Math.max(t[e.order_by].length,i[e.order_by].length);a++){if(void 0==t[e.order_by].charAt(a))return s;if(void 0==i[e.order_by].charAt(a))return-s;if(parseInt(t[e.order_by].toUpperCase().charCodeAt(a))>parseInt(i[e.order_by].toUpperCase().charCodeAt(a)))return s;if(parseInt(t[e.order_by].toUpperCase().charCodeAt(a))<parseInt(i[e.order_by].toUpperCase().charCodeAt(a)))return-s}return 0}),t},this._ChunkData=function(t,e){return t.slice(e.starting_from,e.starting_from+e.limit)},this._InvokeEvent=function(t,e){void 0!=this.m_oOptions.event_handlers&&void 0!=this.m_oOptions.event_handlers[t]&&this.m_oOptions.event_handlers[t]instanceof Function&&this.m_oOptions.event_handlers[t](e)},this.GF_Datagrid_Data_Provider(t,e)},GF_Datagrid_Data_Provider.s_adProviders=[],GF_Datagrid_Data_Provider.ReturnInstance=function(t){return void 0!=GF_Datagrid_Data_Provider.s_adProviders[t]?GF_Datagrid_Data_Provider.s_adProviders[t]:null},GF_Datagrid_Data_Provider.ChangeData=function(t){if(void 0!=t.provider_id){var e=GF_Datagrid_Data_Provider.ReturnInstance(t.provider_id);e.ChangeData(t.data)}},GF_Datagrid=GF_Instance.GF_Extend("GF_Datagrid",function(t,e){return this.m_oOptions,this.m_aoColumns,this.m_aiColumnsOrder,this.m_oColumnsLookup,this.m_aoRows,this.m_aoAdditionalRows,this.m_asSelected,this.m_jHeader,this.m_jBody,this.m_jAdditionalRows,this.m_jFooter,this.m_jInput,this.m_jModifyColumnsDialog,this.m_s_cContextMenu,this.m_aoAdditionalFilters,this.m_iPadding,this.m_iWidth,this.m_iTotalWidth,this.m_iScrollbarWidth,this.m_i_SpacerDrag,this.m_iFirstRecordId,this.m_iRows,this.m_iTotalRows,this.m_iFilteredRows,this.m_sOrderBy,this.m_iOrderDirection,this.m_iPage,this.m_iTotalPages,this.GF_Datagrid,this.GetSelected,this.IsSelected,this.ClearSelection,this.LoadData,this.Rewrite,this.SelectThisRow,this.SelectRow,this.DeselectRow,this.SelectVisible,this.DeselectVisible,this.GoToPage,this.GoToNext,this.GoToPrevious,this.GoToFirst,this.UpdateSelection,this.UpdateIndicators,this.ToggleFilters,this.GetRow,this.GetCurrentRow,this.ChangeAdditionalFilters,this.GetRowIdByAttribute,this._ParseOptions,this._ParseColumnOptions,this._InitializeSpacers,this._SpacerDragInit,this._SpacerDrag,this._SpacerDragStop,this.WaitingScreenShow,this.WaitingScreenHide,this._ProcessData,this._WriteRow,this._WriteRowsActions,this._WriteRowsAction,this._ProcessRowsActions,this._WriteGroupActions,this._WriteGroupAction,this._ProcessGroupActions,this._ShowSelection,this._ChangeOrder,this._GetNameForTd,this._GetIdFromTr,this._GetTrForId,this._GetColumnByName,this._GetConditionForField,this._CreateDatagrid,this._CreateHeader,this._WriteHeader,this._CreateFilter,this._WriteFilters,this._WriteFilter,this._CreateBody,this._CreateFooter,this._CreateModifyColumnsDialog,this._InitializeWidths,this._UpdateWidths,this._UpdateHeights,this._InitializeEvents,this._InitializeRowEvents,this._HandleGoToPage,this._HandleGoToNext,this._HandleGoToPrevious,this._HandleGoToFirst,this._HandleToggleColumns,this._HandleCheckRowsCheckbox,this._HandleToggleSelectVisible,this._HandleChangeColumns,this._HandleSaveColumns,this._HandleRestoreColumns,this._HandleShowContextMenu,this._HandleHideContextMenu,this._NewRowEventHandler,this.GF_Datagrid=GF.NewConstructor(function(t,e){this.RefreshTarget(),this.m_aoColumns=[],this.m_aoRows=[],this.m_aoAdditionalRows=[],this.m_aiColumnsOrder=[],this.m_oColumnsLookup={},this.m_oOptions={},this.m_asSelected=[],this.m_iFirstRecordId=0,this.m_iRows=0,this.m_iTotalRows=0,this.m_iFilteredRows=0,this.m_sOrderBy="",this.m_iOrderDirection="",this.m_iPage=0,this.m_iTotalPages=0,this.m_bDontLoad=!1,this.m_bFirstLoad=!0,this.m_i_SpacerDrag=GF.NULL,this._ParseOptions(e),this.m_sOrderBy=this.m_oOptions.mechanics.default_sorting,this.m_iOrderDirection=this._GetColumnByName(this.m_sOrderBy).sorting.default_order,this._CreateDatagrid(),this._InitializeWidths(),this._InitializeSpacers(),this._InitializeEvents(),this.m_oOptions.appearance.filter,this.LoadData()}),this.GetSelected=function(){return this.m_asSelected},this.IsSelected=function(t){var e;t instanceof $?e=this._GetIdFromTr(t):"string"==typeof t||"number"==typeof t?e=t:t instanceof Object?e=t[this.m_oOptions.mechanics.key]:GF_Debug.Error("Invalid argument passed to the datagrid's IsSelected method: "+typeof oRow+".");for(var i in this.m_asSelected)if(this.m_asSelected[i]==e)return!0;return!1},this.ClearSelection=GF.NewEventHandler(function(t){var e=GF_Datagrid.GetCurrentInstance(this),i=e.m_asSelected.concat([]);for(var s in i)e.DeselectRow(i[s])}),this.LoadData=function(){var t=GF_Datagrid.GetCurrentInstance(this);if(!t.m_bDontLoad){var e=[],i=[];t.WaitingScreenShow(function(){var t=GF_Datagrid.GetCurrentInstance(this);for(var s in t.m_aiColumnsOrder){
    var a=t.m_aoColumns[t.m_aiColumnsOrder[s]];e.push(a.id),t.m_oOptions.appearance.filter&&(i=i.concat(t._GetConditionForField(a.id)))}i=i.concat(this.m_aoAdditionalFilters);var n=sessionStorage.getItem("GF_Datagrid_State_"+Base64.encode(window.location.pathname+t.m_oOptions.id)),o={id:t.m_iId,from:e.join(", "),starting_from:(isNaN(t.m_iPage)?0:t.m_iPage)*t.m_oOptions.mechanics.rows_per_page,limit:t.m_oOptions.mechanics.rows_per_page,order_by:t.m_sOrderBy,order_dir:t.m_iOrderDirection==GF_Datagrid.SORT_DIR_ASC?"asc":"desc",where:i};if(this.m_oOptions.mechanics.persistent){this.m_bFirstLoad&&(n?o=$.parseJSON(Base64.decode(n)):window.location.hash.length&&(o=$.parseJSON(Base64.decode(window.location.hash))));var r=Base64.encode(JSON.stringify(o));window.location.hash=r,sessionStorage.setItem("GF_Datagrid_State_"+Base64.encode(window.location.pathname+t.m_oOptions.id),r),this._ChangeOrderIndicator(o.order_by,o.order_dir)}t.m_oOptions.event_handlers.load(o),this.m_bFirstLoad=!1})}},this.MakeRequest=function(t,e,i){$.ajax({type:"POST",url:t,data:e,success:i,dataType:"json"})},this.Reset=function(){var t=GF_Datagrid.GetCurrentInstance(this);t.m_jFilter.find("input, select").val("").parent().find(".faux span").text(""),t.m_iPage=-1,t.GoToFirst()},this.Rewrite=function(){this.m_jBody.empty(),this.m_jAdditionalRows.empty();for(var t in this.m_aoRows){var e=this.m_aoRows[t],i=this._WriteRow(e);i.addClass(t%2?"e":"o"),this.m_jBody.append(i)}for(t in this.m_aoAdditionalRows)e=this.m_aoAdditionalRows[t],i=this._WriteAdditionalRow(e),i.addClass(t%2?"e":"o"),this.m_jAdditionalRows.append(i);this._UpdateWidths(),this._UpdateHeights(),this.WaitingScreenHide(),this.UpdateIndicators(),this.m_oOptions.event_handlers.loaded instanceof Function&&this.m_oOptions.event_handlers.loaded(this),this.UpdateSelection()},this.SelectThisRow=GF.NewEventHandler(function(t){var e=GF_Datagrid.GetCurrentInstance(this),i=$(this).is("tr")?$(this):$(this).parents("tr:first");if(!i.length)return GF_Debug.Warning("Datagrid's SelectThisRow invoked neither on a TR element nor on any of its descendants. Selection aborted."),!1;var s=e._GetIdFromTr(i);return e.m_oOptions.event_handlers.click_row instanceof Function&&!e.m_oOptions.event_handlers.click_row(e.m_iId,s)?!1:(e.IsSelected(s)?e.DeselectRow(s):e.SelectRow(s),!1)}),this.SelectRow=function(t){var e=this._GetTrForId(t);if(GF.InArray(this.m_asSelected,t))return!1;if(this.m_oOptions.mechanics.only_one_selected)for(var i in this.m_asSelected)this.DeselectRow(this.m_asSelected[i]);this.m_asSelected.push(t),this._ShowSelection(e),this.m_oOptions.event_handlers.select instanceof Function&&this.m_oOptions.event_handlers.select(this,t),this.UpdateSelection()},this.DeselectRow=function(t){var e=this._GetTrForId(t);GF.DeleteFromArray(this.m_asSelected,t),e.removeClass("selected"),GF.CheckboxesUncheck(e),this.m_oOptions.event_handlers.deselect instanceof Function&&this.m_oOptions.event_handlers.deselect(this,t),this.UpdateSelection()},this.SelectVisible=function(){for(var t in this.m_aoRows)this.SelectRow(this.m_aoRows[t][this.m_oOptions.mechanics.key])},this.DeselectVisible=function(){for(var t in this.m_aoRows)this.DeselectRow(this.m_aoRows[t][this.m_oOptions.mechanics.key])},this.GoToPage=function(t){var e=Math.max(0,Math.min(this.m_iTotalPages-1,t));return e==this.m_iPage?void this.UpdateIndicators():(this.m_iPage=e,this.UpdateIndicators(),void this.LoadData())},this.GoToNext=function(){this.GoToPage(this.m_iPage+1)},this.GoToPrevious=function(){this.GoToPage(this.m_iPage-1)},this.GoToFirst=function(){this.GoToPage(0)},this.GoToLast=function(){this.GoToPage(this.m_iTotalPages-1)},this.UpdateSelection=function(){var t=0;for(var e in this.m_aoRows)this.IsSelected(this.m_aoRows[e])&&t++;t&&t>=this.m_aoRows.length?this.m_jHeader&&this.m_jHeader.length&&GF.CheckboxesCheck(this.m_jHeader.find(".GF_Datagrid_Col__select")):this.m_jHeader&&this.m_jHeader.length&&GF.CheckboxesUncheck(this.m_jHeader.find(".GF_Datagrid_Col__select")),this.m_oOptions.event_handlers.selection_changed instanceof Function&&this.m_oOptions.event_handlers.selection_changed(this,this.m_asSelected),this.UpdateIndicators(),$('[name="'+this.m_oOptions.id+'"]').val(this.m_asSelected.join(",")).change()},this.UpdateIndicators=function(){this.m_jFooter&&(this.m_jFooter.find(".GF_Datagrid_records_from").text(0==this.m_iFilteredRows?0:this.m_iFirstRecordId+1),this.m_jFooter.find(".GF_Datagrid_records_to").text(isNaN(this.m_iFirstRecordId+this.m_aoRows.length)?0:this.m_iFirstRecordId+this.m_aoRows.length),this.m_iFilteredRows==this.m_iTotalRows?this.m_jFooter.find(".GF_Datagrid_records_total").text(this.m_iFilteredRows):this.m_jFooter.find(".GF_Datagrid_records_total").html(this.m_iFilteredRows+' <img src="'+GF_Datagrid.Files.warning_icon+'" alt="'+GF_Datagrid.Language.not_all_shown+(this.m_iTotalRows-this.m_iFilteredRows)+'" title="'+GF_Datagrid.Language.not_all_shown+(this.m_iTotalRows-this.m_iFilteredRows)+'"/>'),this.m_jFooter.find(".GF_Datagrid_selected_records").text(this.m_asSelected.length),this.m_jFooter.find(".GF_Datagrid_page").val(isNaN(this.m_iPage+1)?1:this.m_iPage+1),this.m_asSelected.length?this.m_jFooter.find(".GF_Datagrid_clear_selection").fadeIn("fast"):this.m_jFooter.find(".GF_Datagrid_clear_selection").fadeOut("fast")),this.m_oOptions.external_indicators.total_rows!=GF.NULL&&this.m_oOptions.external_indicators.total_rows.text(this.m_iFilteredRows),this.m_oOptions.external_indicators.rows_from!=GF.NULL&&this.m_oOptions.external_indicators.rows_from.text(this.m_iFirstRecordId+1),this.m_oOptions.external_indicators.rows_to!=GF.NULL&&this.m_oOptions.external_indicators.rows_to.text(this.m_iFirstRecordId+this.m_aoRows.length),this.m_oOptions.external_indicators.page!=GF.NULL&&this.m_oOptions.external_indicators.page.text(this.m_iPage+1),this.m_oOptions.external_indicators.total_pages!=GF.NULL&&this.m_oOptions.external_indicators.total_pages.text(this.m_iTotalPages)},this.ToggleFilters=GF.NewEventHandler(function(t){var e=GF_Datagrid.GetCurrentInstance(this);e.m_jFilter.find("td:not(.GF_Datagrid_Col__retract_filters) > span").slideToggle(500,GF.NewEventHandler(function(t){var e=GF_Datagrid.GetCurrentInstance(this);e._UpdateHeights()}));var i=e.m_jFilter.find(".GF_Datagrid_Col__retract_filters img").attr("src");return e.m_jFilter.find(".GF_Datagrid_Col__retract_filters img").attr("title",i!=GF_Datagrid.Files.expand_filters_icon?GF_Datagrid.Language.expand_filters:GF_Datagrid.Language.retract_filters),e.m_jFilter.find(".GF_Datagrid_Col__retract_filters img").attr("alt",i!=GF_Datagrid.Files.expand_filters_icon?GF_Datagrid.Language.expand_filters:GF_Datagrid.Language.retract_filters),e.m_jFilter.find(".GF_Datagrid_Col__retract_filters img").attr("src",i!=GF_Datagrid.Files.expand_filters_icon?GF_Datagrid.Files.expand_filters_icon:GF_Datagrid.Files.retract_filters_icon),!1}),this.GetRow=function(t){for(var e in this.m_aoRows)if(this.m_aoRows[e][this.m_oOptions.mechanics.key]==t)return this.m_aoRows[e];return GF_Debug.Warning("Requested row ("+t+") was not found."),!1},this.GetCurrentRow=function(t){return this.GetRow(this._GetIdFromTr(t))},this.ChangeAdditionalFilters=GF.NewSafeMethod(function(t){this.m_aoAdditionalFilters=t,this.LoadData()}),this.GetRowIdByAttribute=GF.NewSafeMethod(function(t,e){for(var i in this.m_aoRows)if(this.m_aoRows[i][t]==e)return this.m_aoRows[i][this.m_oOptions.mechanics.key];return!1}),this.WaitingScreenShow=function(t){this.m_jTarget.children(".progress").remove();var e=$('<div class="progress"><div class="bar"><div class="indicator"></div></div></div>');e.css("display","none").css("top",this.m_jTarget.find(".header").height()-1).css("bottom",this.m_jFooter&&this.m_jFooter.length?this.m_jFooter.get(0).clientHeight:2),this.m_jTarget.append(e);var i=this;e.fadeIn(50,function(){t.apply(i)})},this.WaitingScreenHide=function(){this.m_jTarget.children(".progress").fadeOut(100,GF.NewEventHandler(function(t){$(this).remove()}))},this._ParseOptions=function(t){this.m_oOptions=new GF_Datagrid_Config(t),this.m_oOptions.id!=GF.NULL&&this.m_oOptions.id.length||GF_Debug.Error("Datagrid's id isn't set correctly. Datagrid initialization failed."),this._ParseColumnOptions(),this._ProcessRowsActions(this.m_oOptions.row_actions),this._ProcessRowsActions(this.m_oOptions.context_actions),this._ProcessGroupActions(this.m_oOptions.group_actions),this.m_aoAdditionalFilters=this.m_oOptions.additional_filters},this._ParseColumnOptions=function(){this.m_aoColumns=[],this.m_aiColumnsOrder=[],this.m_oOptions.appearance.column_select&&(this.m_aoColumns.push(new GF_Datagrid_Column({id:"_select",caption:this.m_oOptions.mechanics.only_one_selected?"&nbsp;":'<input type="checkbox"/>',appearance:{width:24,align:GF_Datagrid.ALIGN_CENTER},sorting:{allowed:!1}})),this.m_aiColumnsOrder.push(0),this.m_oColumnsLookup[this.m_aoColumns[this.m_aoColumns.length-1].id]=this.m_aoColumns.length-1);for(var t in this.m_oOptions.columns){var e=this.m_aoColumns.push(GF.Clone(this.m_oOptions.columns[t]))-1;this.m_oOptions.columns[t].appearance.visible&&this.m_aiColumnsOrder.push(e),this.m_oColumnsLookup[this.m_aoColumns[this.m_aoColumns.length-1].id]=this.m_aoColumns.length-1}this.m_oOptions.appearance.column_options&&this.m_oOptions.row_actions.length&&(this.m_aoColumns.push(new GF_Datagrid_Column({id:"_options",caption:GF_Datagrid.Language.options,appearance:{width:1==this.m_oOptions.row_actions.length?30:20*this.m_oOptions.row_actions.length},sorting:{allowed:!1}})),this.m_aiColumnsOrder.push(this.m_aoColumns.length-1),this.m_oColumnsLookup[this.m_aoColumns[this.m_aoColumns.length-1].id]=this.m_aoColumns.length-1);var i=GCookie("GF_Datagrid_Columns_"+this.m_oOptions.id);if(i){this.m_aiColumnsOrder=JSON.parse(i);var s=GCookie("GF_Datagrid_Widths_"+this.m_oOptions.id);if(s&&s.length){var a=JSON.parse(s);if(a.length==this.m_aiColumnsOrder.length)for(var t in this.m_aiColumnsOrder)this.m_aoColumns[this.m_aiColumnsOrder[t]].appearance.width=a[t]}}},this._InitializeSpacers=function(){this.m_jTarget.children(".spacer").remove();var t=0;for(var e in this.m_aiColumnsOrder){var i=this.m_aoColumns[this.m_aiColumnsOrder[e]];if(t+=i.appearance.width,e==this.m_aiColumnsOrder.length-1)break;var s=$('<div class="spacer"><div class="head"></div></div>');this.m_oOptions.mechanics.no_column_resizing||0==e&&this.m_oOptions.appearance.column_select||this.m_oOptions.appearance.column_options&&e==this.m_aiColumnsOrder.length-2||s.addClass("spacer-flexible").mousedown(this._SpacerDragInit),this.m_jFooter?this.m_jFooter.before(s):this.m_jTarget.append(s),s.css("left",t-Math.ceil(parseInt(s.css("width"))/2))}},this._SpacerDragInit=GF.NewEventHandler(function(t){var e=GF_Datagrid.GetCurrentInstance(this);return e.m_i_SpacerDrag!=GF.NULL?!1:($(this).addClass("spacer-on"),e.m_i_SpacerDrag=e.m_jTarget.find(".spacer").index($(this)),!1)}),this._SpacerDrag=GF.NewEventHandler(function(t){var e=GF_Datagrid.GetCurrentInstance(this);if(e.m_i_SpacerDrag==GF.NULL)return!0;var i=t.clientX-e.m_jTarget.offset().left,s=e.m_jTarget.find(".spacer"),a=s.eq(e.m_i_SpacerDrag-1),n=s.eq(e.m_i_SpacerDrag+1),o=s.eq(e.m_i_SpacerDrag);a.length?n.length?o.css("left",Math.min(parseInt(n.css("left"))-2*e.m_iPadding-48,Math.max(parseInt(a.css("left"))+2*e.m_iPadding+48,i-Math.ceil(parseInt(o.css("width"))/2)))):o.css("left",Math.min(parseInt(e.m_jTarget.get(0).clientWidth)-2*e.m_iPadding-48,Math.max(parseInt(a.css("left"))+2*e.m_iPadding+48,i-Math.ceil(parseInt(o.css("width"))/2)))):n.length?o.css("left",Math.min(parseInt(n.css("left"))-2*e.m_iPadding-48,Math.max(48+2*e.m_iPadding,i-Math.ceil(parseInt(o.css("width"))/2)))):o.css("left",Math.min(parseInt(e.m_jTarget.get(0).clientWidth)-2*e.m_iPadding-48,Math.max(48+2*e.m_iPadding,i-Math.ceil(parseInt(o.css("width"))/2))));for(var r=0,_=0,d=parseInt(e.m_jTarget.get(0).clientWidth)-e.m_iScrollbarWidth,l=0;l<s.length;l++){var c=e.m_aoColumns[e.m_aiColumnsOrder[l]];_=parseInt(s.eq(l).css("left"))+Math.ceil(parseInt(s.eq(l).css("width"))/2),c.appearance.width=_-r,r=_,d-=c.appearance.width}var c=e.m_aoColumns[e.m_aiColumnsOrder[l]];return c.appearance.width=d,e._UpdateWidths(),!0}),this._SpacerDragStop=GF.NewEventHandler(function(t){var e=GF_Datagrid.GetCurrentInstance(this);return e.m_jTarget.find(".spacer:eq("+e.m_i_SpacerDrag+")").removeClass("spacer-on"),e.m_i_SpacerDrag=GF.NULL,!1}),this._ProcessData=function(t){this.m_iRows=parseInt(t.rows_num),this.m_iTotalRows=parseInt(t.total),this.m_iFilteredRows=parseInt(t.filtered),this.m_iFirstRecordId=parseInt(t.starting_from),this.m_iTotalPages=Math.ceil(this.m_iFilteredRows/this.m_oOptions.mechanics.rows_per_page),this.m_iPage=Math.floor(this.m_iFirstRecordId/this.m_iFilteredRows*this.m_iTotalPages),this.m_aoRows=t.rows,this.m_aoAdditionalRows=t.additional_rows?t.additional_rows:[],this.Rewrite()},this._WriteRow=function(t){var e=$("<tr></tr>");if(this.m_oOptions.event_handlers.process instanceof Function)var i=this.m_oOptions.event_handlers.process(GCore.Duplicate(t));else var i=GCore.Duplicate(t);for(var s in this.m_aiColumnsOrder){var a,n,o=this.m_aoColumns[this.m_aiColumnsOrder[s]];switch(a=o.id==this.m_oOptions.mechanics.key?$('<th scope="row"></th>'):$("<td></td>"),a.addClass("GF_Datagrid_Col_"+o.id),o.appearance.align){case GF_Datagrid.ALIGN_CENTER:a.addClass("c");break;case GF_Datagrid.ALIGN_LEFT:a.addClass("l");break;case GF_Datagrid.ALIGN_RIGHT:a.addClass("r")}var r=$("<span></span>");switch(o.id){case"_select":n='<input type="checkbox"/>';break;case"_options":n=this._WriteRowsActions(t);break;default:if(o.editable)n=void 0!=i[o.id]?i[o.id]:"",a.addClass("editable"),n=$('<input type="text" value="'+n+'" name="'+this.m_oOptions.id+"["+t[this.m_oOptions.mechanics.key]+"]["+o.id+']"/>'),n.data("sPreviousValue",n.val());else if(o.selectable){n=void 0!=i[o.id]?i[o.id]:"",a.addClass("selectable");var _=$('<select name="'+this.m_oOptions.id+"["+t[this.m_oOptions.mechanics.key]+"]["+o.id+']"/>'),d=o.filter.options;if(d.length>1||1==d.length&&""!=d[0].id){for(var l in d)jOption=$('<option value="'+d[l].id+'"'+(d[l].id==n?' selected="selected"':"")+"/>"),jOption.text(d[l].caption),void 0!=d[l].options&&(jOption.get(0).aoOptions=d[l].options),_.append(jOption);n=$('<div class="field-select"/>').append($('<span class="field"/>').append(_))}else{var d=$.parseJSON(t[o.id+"__options"].replace(/\\"/g,'"'));if(d.length>1||1==d.length&&""!=d[0].id){for(var l in d)jOption=$('<option value="'+d[l].id+'"'+(d[l].id==n?' selected="selected"':"")+"/>"),jOption.text(d[l].caption),void 0!=d[l].options&&(jOption.get(0).aoOptions=d[l].options),_.append(jOption);n=$('<div class="field-select"/>').append($('<span class="field"/>').append(_))}else n=""}_.data("sPreviousValue",_.find("option:selected").attr("value"))}else n=""+(void 0!=i[o.id]?i[o.id]:"&nbsp;"),o.appearance.no_title||r.attr("title",o.caption+": "+n.replace(/ {2,}/," ").replace(/\&nbsp\;/,"-").replace(/<[^>]+>/,"").replace(/<\/?[^>]+>/gi,""))}a.append(r.append(n)),0==s&&a.append('<span style="display: none;" class="GF_Datagrid_Row_Id">'+t[this.m_oOptions.mechanics.key]+"</span>"),this.IsSelected(t)&&this._ShowSelection(e),e.append(a)}return this._InitializeRowEvents(e),e},this._WriteAdditionalRow=function(t){var e=$("<tr></tr>"),i=t;for(var s in this.m_aiColumnsOrder){var a,n,o=this.m_aoColumns[this.m_aiColumnsOrder[s]];switch(a=o.id==this.m_oOptions.mechanics.key?$('<th scope="row"></th>'):$("<td></td>"),a.addClass("GF_Datagrid_Col_"+o.id),o.appearance.align){case GF_Datagrid.ALIGN_CENTER:a.addClass("c");break;case GF_Datagrid.ALIGN_LEFT:a.addClass("l");break;case GF_Datagrid.ALIGN_RIGHT:a.addClass("r")}switch(o.id){case"_select":n="&nbsp;";break;case"_options":n="&nbsp;";break;default:n=void 0!=i[o.id]?i[o.id]:"&nbsp;"}var r=$("<span></span>");a.append(r.append(n)),0==s&&a.append('<span style="display: none;" class="GF_Datagrid_Row_Id">'+t[this.m_oOptions.mechanics.key]+"</span>"),e.append(a)}return t._options.className&&e.addClass(t._options.className),t._options.caption&&e.attr("title",t._options.caption),e},this._WriteRowsActions=function(t){var e=t[this.m_oOptions.mechanics.key],i=$("<ul></ul>");if(GF.InArray(this.m_oOptions.no_actions_for_rows,e))return i;for(var s in this.m_oOptions.row_actions){var a=this.m_oOptions.row_actions[s];(a.condition==GF.NULL||"function"==typeof a.condition&&a.condition(t))&&i.append(this._WriteRowsAction(a,e))}return i},this._WriteRowsAction=function(t,e){var i=$("<li></li>"),s=$('<a href="#" title="'+t.caption+'"><img src="'+t.img+'" alt="'+t.caption+'"/></a>');if(GF.CountMembers(t.values)){var a=[];for(var n in t.values)a.push(new GF_Action({img:t.img,action:t.action,caption:t.values[n],parameter:n}));s.click(GF.NewEventHandler(function(t){return GF_ContextMenu.Create({id:e,parent:$(this),actions:a,position:{left:t.pageX-16,top:t.pageY-10}}),!1}))}else s.click(GF.NewEventHandler(function(i){return t.action(e),!1}));return i.append(s),i},this._ProcessRowsActions=function(t){for(var e in t){var i=t[e],s=!1;switch(i){case GF_Datagrid.ACTION_DELETE:i=new GF_Action({img:GF_Datagrid.Files.delete_row_icon,caption:GF_Datagrid.Language.delete_row,action:this.m_oOptions.event_handlers.delete_row});break;case GF_Datagrid.ACTION_EDIT:i=new GF_Action({img:GF_Datagrid.Files.edit_row_icon,caption:GF_Datagrid.Language.edit_row,action:this.m_oOptions.event_handlers.edit_row});break;case GF_Datagrid.ACTION_VIEW:i=new GF_Action({img:GF_Datagrid.Files.view_row_icon,caption:GF_Datagrid.Language.view_row,action:this.m_oOptions.event_handlers.view_row})}s||(t[e]=this._ProcessAction(i))}return t},this._WriteGroupActions=function(){var t=$("<ul></ul>");for(var e in this.m_oOptions.group_actions){var i=this.m_oOptions.group_actions[e];t.append(this._WriteGroupAction(i))}return t},this._WriteGroupAction=function(t){var e=$("<li></li>"),i=$('<a href="#" title="'+t.caption+'"><img src="'+t.img+'" alt="'+t.caption+'"/></a>'),s=this.m_asSelected;if(GF.CountMembers(t.values)){var a=[];for(var n in t.values)a.push(new GF_Action({img:t.img,action:t.action,caption:t.values[n],parameter:n}));i.click(GF.NewEventHandler(function(e){return s.length?(GF_ContextMenu.Create({id:s,parent:$(this),actions:a,position:{left:e.pageX-15,top:e.pageY+12}}),!1):(new GF_Alert(t.caption,GF_Datagrid.Language.no_rows_selected),!1)}))}else i.click(GF.NewEventHandler(function(e){return s.length?(t.action(s),!1):(new GF_Alert(t.caption,GF_Datagrid.Language.no_rows_selected),!1)}));return e.append(i),e},this._ProcessGroupActions=function(t){for(var e in t){var i=t[e];switch(i){case GF_Datagrid.ACTION_DELETE_GROUP:i=new GF_Action({img:GF_Datagrid.Files.delete_group_icon,caption:GF_Datagrid.Language.delete_group,action:this.m_oOptions.event_handlers.delete_group})}t[e]=this._ProcessAction(i)}return t},this._ProcessAction=function(t){if(t.processed)return t;t.processed=!0;var e=this,i=t.action,s=function(t,s){try{i(e.m_iId,t,s)}catch(a){return GF_Debug.HandleException(a),!1}};return t.action=s,t},this._ShowSelection=function(t){t.addClass("selected"),GF.CheckboxesCheck(t)},this._ChangeOrder=GF.NewEventHandler(function(t){var e=GF_Datagrid.GetCurrentInstance(this),i=e._GetNameForTd($(this));e.m_jHeader.find(".order_indicator").remove(),e.m_sOrderBy==i?e.m_iOrderDirection=e.m_iOrderDirection==GF_Datagrid.SORT_DIR_ASC?GF_Datagrid.SORT_DIR_DESC:GF_Datagrid.SORT_DIR_ASC:(e.m_sOrderBy=i,e.m_iOrderDirection=e._GetColumnByName(i).sorting.default_order),$(this).children("span").prepend('<img src="'+(e.m_iOrderDirection==GF_Datagrid.SORT_DIR_ASC?GF_Datagrid.Files.order_asc:GF_Datagrid.Files.order_desc)+'" class="order_indicator"/>'),e.LoadData()}),this._ChangeOrderIndicator=function(t,e){var i=GF_Datagrid.GetCurrentInstance(this);i.m_jHeader.find(".order_indicator").remove(),$("th.GF_Datagrid_Col_"+t).children("span").prepend('<img src="'+("asc"==e?GF_Datagrid.Files.order_asc:GF_Datagrid.Files.order_desc)+'" class="order_indicator"/>')},this._GetNameForTd=function(t){if(t instanceof $||GF_Debug.Error("The argument passed to the datagrid's _GetNameForTd method was not a jQuery object: "+typeof t+"."),!t.is("th, td")){var e=t;t=td.parents("td:first"),t.length||(t=e.parents("th:first"),t.length||GF_Debug.Error("The argument passed to the datagrid's _GetNameForTd method was neither a td node nor one of its descendants."))}var i=GF.GetChunkFromClass(t,"GF_Datagrid_Col_");return i},this._GetIdFromTr=function(t){return t instanceof $||GF_Debug.Error("Invalid type of argument passed to the datagrid's _GetIdFromTr method: "+typeof t+". Should be a jQuery instance."),t=t.is("tr")?t:t.closest("tr"),t.length||GF_Debug.Error("Invalid jQuery object passed to the datagrid's _GetIdFromTr method."),t.find(".GF_Datagrid_Row_Id").text()},this._GetTrForId=function(t){for(var e=this.m_jBody.find('tr .GF_Datagrid_Row_Id:contains("'+t+'")'),i=0;i<e.length;i++)if(e.eq(i).text()==t){e=e.eq(i).parents("tr:first");break}return e},this._GetColumnByName=function(t){return void 0==this.m_oColumnsLookup[t]&&GF_Debug.Warning("Column with the specified name ("+t+") was not found in the datagrid."),this.m_aoColumns[this.m_oColumnsLookup[t]]},this._GetConditionForField=function(t){var e=this._GetColumnByName(t),i=[];switch(e.filter.type){case GF_Datagrid.FILTER_BETWEEN:var s=this.m_jFilter.find(".GF_Datagrid_Col_"+e.id+" input.from");s.length||GF_Debug.Warning("Filter field for the specified column ("+e.id+") wasn't found."),void 0==s.val()&&GF_Debug.Error("Filter field for the specified column ("+e.id+") has an incorrect value."),s.val().length&&i.push({column:void 0!=e.filter.filtered_column&&e.filter.filtered_column!=GF.NULL?e.filter.filtered_column:e.id,value:s.val(),operator:"GE"}),s=this.m_jFilter.find(".GF_Datagrid_Col_"+e.id+" input.to"),s.length||GF_Debug.Warning("Filter field for the specified column ("+e.id+") wasn't found."),void 0==s.val()&&GF_Debug.Error("Filter field for the specified column ("+e.id+") has an incorrect value."),s.val().length&&i.push({column:void 0!=e.filter.filtered_column&&e.filter.filtered_column!=GF.NULL?e.filter.filtered_column:e.id,value:s.val(),operator:"LE"});break;case GF_Datagrid.FILTER_INPUT:case GF_Datagrid.FILTER_AUTOSUGGEST:var s=this.m_jFilter.find(".GF_Datagrid_Col_"+e.id+" input");s.length||GF_Debug.Warning("Filter field for the specified column ("+e.id+") wasn't found."),void 0==s.val()&&GF_Debug.Error("Filter field for the specified column ("+e.id+") has an incorrect value."),s.val().length&&i.push({column:void 0!=e.filter.filtered_column&&e.filter.filtered_column!=GF.NULL?e.filter.filtered_column:e.id,value:"%"+s.val()+"%",operator:"LIKE"});break;case GF_Datagrid.FILTER_SELECT:var s=this.m_jFilter.find(".GF_Datagrid_Col_"+e.id+" select");if(s.length||GF_Debug.Warning("Filter field for the specified column ("+e.id+") wasn't found."),void 0==s.val()){GF_Debug.Warning("Filter field for the specified column ("+e.id+") has an incorrect value.");break}s.val().length&&i.push({column:void 0!=e.filter.filtered_column&&e.filter.filtered_column!=GF.NULL?e.filter.filtered_column:e.id,value:"%"+s.val()+"%",operator:"LIKE"});break;case GF_Datagrid.FILTER_TREE:var a=this.m_jFilter.find(".GF_Datagrid_Col_"+e.id+" .GF_Datagrid_filter_tree").data("jPanel");if(void 0==a)break;var n=this._BuildTreeConditions(a.children("ul:first"));n.length&&i.push({column:void 0!=e.filter.filtered_column&&e.filter.filtered_column!=GF.NULL?e.filter.filtered_column:e.id,value:n,operator:"IN"})}return i},this._BuildTreeConditions=function(t){for(var e=[],i=t.children("li"),s=i.length,a=0;s>a;a++)i.eq(a).children("label").children("input").is(":checked")?e.push(i.eq(a).data("sId")):e=e.concat(this._BuildTreeConditions(i.eq(a).children("ul:first")));return e},this._InitializeWidths=function(){this.m_iTotalWidth=this.m_jTarget.width(),!this.m_oOptions.mechanics.no_column_modification||this.m_oOptions.appearance.max_height?this.m_iScrollbarWidth=Math.max(26,this.m_iTotalWidth-this.m_jTarget.find(".body").get(0).clientWidth):this.m_iScrollbarWidth=0,this.m_iWidth=this.m_iTotalWidth-this.m_iScrollbarWidth,this.m_jHeader&&this.m_jHeader.length?this.m_iPadding=(this.m_jHeader.find("th:first").get(0).clientWidth-this.m_jHeader.find("th:first span").get(0).clientWidth)/2:this.m_iPadding=4;var t,e=this.m_iWidth,i=0;for(t in this.m_aiColumnsOrder){var s=this.m_aoColumns[this.m_aiColumnsOrder[t]];s.appearance.width!=GF_Datagrid.WIDTH_AUTO?e-=s.appearance.width:i++}for(t in this.m_aiColumnsOrder){var s=this.m_aoColumns[this.m_aiColumnsOrder[t]];if(s.appearance.width==GF_Datagrid.WIDTH_AUTO){var a=Math.floor(e/i--);e-=a,s.appearance.width=a}}if(0!=e){iNumberOfColumnsLeft=this.m_aiColumnsOrder.length,this.m_oOptions.appearance.column_options&&iNumberOfColumnsLeft--,this.m_oOptions.appearance.column_select&&iNumberOfColumnsLeft--;for(var t in this.m_aiColumnsOrder){var s=this.m_aoColumns[this.m_aiColumnsOrder[t]];if("_options"!=s.id&&"_select"!=s.id){var a=Math.floor(e/iNumberOfColumnsLeft--);e-=a,s.appearance.width+=a}}if(0!=e){if(this.m_oOptions.appearance.column_options)var n=this.m_aoColumns[this.m_aiColumnsOrder[this.m_aiColumnsOrder.length-2]];else var n=this.m_aoColumns[this.m_aiColumnsOrder[this.m_aiColumnsOrder.length-1]];n.appearance.width+=e}}var a=0,o=!1;for(var t in this.m_aiColumnsOrder){var s=this.m_aoColumns[this.m_aiColumnsOrder[t]];if("_options"!=s.id&&"_select"!=s.id&&s.appearance.width<48){o=!0;break}}if(o){e=this.m_iWidth,iNumberOfColumnsLeft=this.m_aiColumnsOrder.length;for(t in this.m_aiColumnsOrder){var s=this.m_aoColumns[this.m_aiColumnsOrder[t]];if("_options"!=s.id&&"_select"!=s.id){var a=Math.floor(e/iNumberOfColumnsLeft--);e-=a,s.appearance.width=a}else e-=s.appearance.width,iNumberOfColumnsLeft--}if(0!=e){if(this.m_oOptions.appearance.column_options)var n=this.m_aoColumns[this.m_aiColumnsOrder[this.m_aiColumnsOrder.length-2]];else var n=this.m_aoColumns[this.m_aiColumnsOrder[this.m_aiColumnsOrder.length-1]];n.appearance.width+=e}}this._UpdateWidths(),this._UpdateHeights()},this._UpdateWidths=function(){this.m_oOptions.appearance.header&&this.m_jHeader.find(".GF_Datagrid_Col__modify_columns").css("width",this.m_iScrollbarWidth);for(i in this.m_aiColumnsOrder){var t=this.m_aoColumns[this.m_aiColumnsOrder[i]];this.m_jTarget.find(".GF_Datagrid_Col_"+t.id).css("width",t.appearance.width-2*this.m_iPadding),this.m_jTarget.find(".GF_Datagrid_Col_"+t.id).children("span").css("width",t.appearance.width-2*this.m_iPadding),this.m_oOptions.appearance.max_height||i!=this.m_aiColumnsOrder.length-1||(this.m_jBody.find(".GF_Datagrid_Col_"+t.id).css("width",t.appearance.width-2*this.m_iPadding),this.m_jAdditionalRows.find(".GF_Datagrid_Col_"+t.id).css("width",t.appearance.width-2*this.m_iPadding),this.m_jBody.find(".GF_Datagrid_Col_"+t.id).children("span").css("width",t.appearance.width-2*this.m_iPadding+this.m_iScrollbarWidth),this.m_jAdditionalRows.find(".GF_Datagrid_Col_"+t.id).children("span").css("width",t.appearance.width-2*this.m_iPadding+this.m_iScrollbarWidth)),this.m_jFilter&&(this.m_jFilter.find(".GF_Datagrid_Col_"+t.id).find(".GF_Datagrid_filter_input input, .GF_Datagrid_filter_auto_suggest input").css("width",t.appearance.width-2*this.m_iPadding-6),this.m_jFilter.find(".GF_Datagrid_Col_"+t.id).find(".GF_Datagrid_filter_between input").css("width",t.appearance.width-2*this.m_iPadding-4-30)),this.m_jBody.find(".GF_Datagrid_Col_"+t.id+".editable input").css("width",t.appearance.width-2*this.m_iPadding-6),this.m_jBody.find(".GF_Datagrid_Col_"+t.id+".selectable span.field").css("width",t.appearance.width-2*this.m_iPadding-2),this.m_jBody.find(".GF_Datagrid_Col_"+t.id+" .full-width").css("width",t.appearance.width-2*this.m_iPadding-2)}},this._UpdateHeights=function(){for(var t=this.m_jTarget.find(".spacer"),e=0;e<t.length;e++){var i=this.m_jTarget.get(0).clientHeight-this.m_jFooter.get(0).clientHeight-(this.m_oOptions.appearance.footer?2:0);i-=this.m_jAdditionalRows.get(0).clientHeight;for(var s in this.m_aoAdditionalRows){var a=this.m_aoAdditionalRows[s][this.m_aoColumns[this.m_aiColumnsOrder[e]].id],n=this.m_aoAdditionalRows[s][this.m_aoColumns[this.m_aiColumnsOrder[Math.min(this.m_aiColumnsOrder.length-1,e+1)]].id];if(void 0!=a&&""!=a||void 0!=n&&""!=n){i+=this.m_jAdditionalRows.get(0).clientHeight;break}}t.eq(e).css("height",i)}this.m_jHeader&&this.m_jHeader.length&&(this.m_jTarget.find(".spacer .head").css("height",this.m_jHeader.get(0).clientHeight),this.m_jHeader.find(".GF_Datagrid_Col__modify_columns span").css("height",this.m_jHeader.get(0).clientHeight).css("line-height",this.m_jHeader.get(0).clientHeight+"px"))},this._CreateDatagrid=function(){this.m_oOptions.mechanics.create_input&&(this.m_jInput=this.m_jTarget.append('<input type="hidden" name="'+this.m_oOptions.id+'"/>')),this.m_jTarget.append(this._CreateHeader()),this.m_jTarget.append(this._CreateBody()),this.m_jTarget.append(this._CreateAdditionalRows()),this.m_jTarget.append(this._CreateFooter()),this.m_oOptions.appearance.footer||this.m_jFooter.css("display","none"),this.m_oOptions.appearance.filter||this.m_jHeader.find("tbody").css("display","none"),this.m_oOptions.appearance.header||this.m_jHeader.css("display","none")},this._CreateHeader=function(){var t=$('<div class="header"></div>'),e=$('<table cellspacing="0"></table>'),i=$("<thead></thead>"),s=$("<tr></tr>");return t.append(e.append(i.append(s))),this.m_jHeader=s,this._WriteHeader(),this.m_oOptions.appearance.filter&&e.append(this._CreateFilter()),t},this._WriteHeader=function(){this.m_jHeader.empty();for(var t in this.m_aiColumnsOrder){var e=this.m_aoColumns[this.m_aiColumnsOrder[t]],i=$('<th class="GF_Datagrid_Col_'+e.id+'"></th>');i.append("<span>"+e.caption.replace(/ {2,}/,"<br/>")+"</span>"),e.sorting.allowed&&i.addClass("sortable"),e.id==this.m_sOrderBy&&i.children("span").prepend('<img src="'+(this.m_iOrderDirection==GF_Datagrid.SORT_DIR_ASC?GF_Datagrid.Files.order_asc:GF_Datagrid.Files.order_desc)+'" class="order_indicator"/>'),this.m_jHeader.append(i)}(!this.m_oOptions.mechanics.no_column_modification||this.m_oOptions.appearance.max_height)&&this.m_jHeader.append('<th class="GF_Datagrid_Col__modify_columns"><span>'+(this.m_oOptions.mechanics.no_column_modification?"":'<a href="#"><img src="'+GF_Datagrid.Files.modify_columns_icon+'" alt="'+GF_Datagrid.Language.modify_columns+'" title="'+GF_Datagrid.Language.modify_columns+'"/></a>')+"</span></th>")},this._CreateFilter=function(){var t=$("<tbody></tbody>"),e=$("<tr></tr>");return t.append(e),this.m_jFilter=e,this._WriteFilters(),t},this._WriteFilters=function(){this.m_jFilter.empty();var t={},e=GF_Datagrid.GetCurrentInstance(this),i=sessionStorage.getItem("GF_Datagrid_State_"+Base64.encode(window.location.pathname+e.m_oOptions.id));if(this.m_oOptions.mechanics.persistent&&this.m_bFirstLoad)if(i)var t=$.parseJSON(Base64.decode(i));else if(window.location.hash.length)var t=$.parseJSON(Base64.decode(window.location.hash));for(var s in this.m_aiColumnsOrder){var a=this.m_aoColumns[this.m_aiColumnsOrder[s]],n="",o="",r="",_=$('<td class="GF_Datagrid_Col_'+a.id+'"></td>');if(void 0!=t.where)for(var s in t.where){var d=t.where[s];d.column==a.id&&"LIKE"==d.operator&&(n=d.value),d.column==a.id&&"GE"==d.operator&&(o=d.value),d.column==a.id&&"LE"==d.operator&&(r=d.value)}_.append(this._WriteFilter(a.filter,n,o,r)),this.m_jFilter.append(_)}(!this.m_oOptions.mechanics.no_column_modification||this.m_oOptions.appearance.max_height)&&this.m_jFilter.append('<td class="GF_Datagrid_Col__retract_filters"><span><a href="#"><img src="'+GF_Datagrid.Files.retract_filters_icon+'" alt="'+GF_Datagrid.Language.retract_filters+'" title="'+GF_Datagrid.Language.retract_filters+'"/></a></span></td>')},this._WriteFilter=function(t,e,i,s){var a=this,n=$("<span></span>");switch(t.type){case GF_Datagrid.FILTER_INPUT:n.addClass("GF_Datagrid_filter_input");var o=$('<input type="text" value="'+e.replace(/%/g,"")+'"/>');o.change(this.LoadData),o.change(this._HandleGoToFirst),o.keydown(this.PreventEnter),n.append(o);break;case GF_Datagrid.FILTER_AUTOSUGGEST:n.addClass("GF_Datagrid_filter_auto_suggest");
    var o=$('<input type="text" value="'+e.replace(/%/g,"")+'"/>');o.change(this.LoadData),o.change(this._HandleGoToFirst),o.keydown(this.PreventEnter),n.append(o),new GF_Autosuggest(n,{source:t.source,delay:this.m_oOptions.mechanics.auto_suggest_delay,maxSuggestions:this.m_oOptions.mechanics.auto_suggest_suggestions,minLength:this.m_oOptions.mechanics.auto_suggest_min_length});break;case GF_Datagrid.FILTER_BETWEEN:n.addClass("GF_Datagrid_filter_between");var r=$("<label><span>"+GF_Datagrid.Language.from+'</span><input type="text" class="from" value="'+i+'"/></label>'),_=$("<label><span>"+GF_Datagrid.Language.to+'</span><input type="text" class="to" value="'+s+'"/></label>');r.change(this.LoadData),_.change(this.LoadData),r.change(this._HandleGoToFirst),_.change(this._HandleGoToFirst),r.keydown(this.PreventEnter),_.keydown(this.PreventEnter),n.append(r),n.append(_);break;case GF_Datagrid.FILTER_SELECT:n.addClass("GF_Datagrid_filter_select");var d=$("<select></select>");d.append('<option value="" selected></option>');for(var l in t.options)d.append('<option value="'+t.options[l].id+'">'+t.options[l].caption+"</option>");d.change(this.LoadData),d.change(this._HandleGoToFirst),n.append($("<span/>").append(d)),d.GSelect();break;case GF_Datagrid.FILTER_TREE:n.addClass("GF_Datagrid_filter_tree");var c=$('<div class="GF_Datagrid_filter_tree_panel"/>');n.data("jPanel",c);var h=$("<ul/>");n.append(h),c.data("fLoadTree",t.load_children);var u=$("<ul/>");c.append(u),c.GShadow(),c.data("jFilter",n),c.data("bExpanded",!1),$("body").append(c),c.css("display","none");var g=$('<a class="trigger-retract" href="#">'+GF_Datagrid.Language.filter_tree_retract+"</a>"),p=$('<a class="trigger-reset" href="#">'+GF_Datagrid.Language.filter_tree_cancel_all+"</a>"),m=$('<a class="trigger-expand" href="#">'+GF_Datagrid.Language.filter_tree_expand+"</a>");g.click(function(t){return m.click(),!1}),p.click(function(t){return c.find("input:checked").each(function(){this.checked=!1}),c.find("input:first").triggerHandler("change"),a._UpdateTreeList(n),!1}),m.click(function(t){return c.css({left:$(this).closest("td").offset().left-1,top:$(this).closest("td").offset().top+$(this).closest("td").height()+2,"min-width":$(this).closest("td").width()-13}),c.data("bExpanded")?(c.data("bExpanded",!1),c.slideUp(250),$(this).closest("td").removeClass("active")):(c.data("bExpanded",!0),c.slideDown(250),$(this).closest("td").addClass("active")),!1}),n.append(m).append(p);var f;f=void 0==t.options?[]:t.options instanceof Array?t.options:t.options[0];for(var G=f.length,l=0;G>l;l++){var F=$("<li/>");u.append(F),this._WriteTreeItem.apply(this,[F,f[l],!1,t])}c.append(g),this._UpdateTreeList(n,!0);break;default:n.html("&nbsp;")}return n},this._UpdateTreeList=function(t,e){var i=t.find("ul:first");i.empty();var s=t.data("jPanel");if(void 0!=s){sList=this._BuildTreeList(s.children("ul:first")),""==sList?i.append('<li class="none">'+GF_Datagrid.Language.filter_tree_empty+"</li>"):i.html(sList);var a=i.find("li");a.length>5&&(a.slice(5).css("display","none"),i.append("<li>...</li>")),e||s.css({left:t.closest("td").offset().left-1,top:t.closest("td").offset().top+t.closest("td").height()+2,"min-width":t.closest("td").width()-13})}},this._BuildTreeList=function(t){for(var e="",i=t.children("li"),s=i.length,a=0;s>a;a++)if(i.eq(a).children("label").children("input").is(":checked")){var n="",o=i.eq(a).closest("li");do n=o.children("label:first").text()+" &gt; "+n,o=o.parent().parent("li");while(o.length);e+=i.eq(a).closest("li").data("bHasChildren")?'<li title="'+n+'">'+n+"*</li>":'<li title="'+n.substr(0,n.length-6)+'">'+n.substr(0,n.length-6)+"</li>"}else e+=this._BuildTreeList(i.eq(a).children("ul:first"));return e},this._WriteTreeItem=function(t,e,i,s){var a=GF_Datagrid.GetCurrentInstance(this),n=$('<input type="checkbox" value="1"'+(i?' checked="checked"':"")+"/>");if(t.data("sId",e.id),t.data("bLoaded",!1),t.data("bHasChildren",e.hasChildren),t.append($("<label/>").append(n).append(e.name)),e.hasChildren){var o=$('<span class="expander"/>');t.prepend(o),o.click(function(t){a._OnTreeExpand.apply(this,[$.extend(t,{dDg:a})])}),t.append('<ul><li><span class="waiting"/></li></ul>')}n.change(function(e){var i=$(this).is(":checked");i?$(this).closest("li").children("ul").find("input").each(function(){this.checked=!0}):($(this).parentsUntil(".GF_Datagrid_filter_tree_panel").filter("li").children("label").children("input:checked").each(function(){this.checked=!1}),$(this).closest("li").find("input:checked").each(function(){this.checked=!1})),a.LoadData.apply(a),a._UpdateTreeList(t.closest(".GF_Datagrid_filter_tree_panel").data("jFilter"))})},this._OnTreeExpand=function(t){var e=t.dDg,i=$(this).closest("li").data("sId"),s=$(this).closest("li").data("bLoaded"),a=$(this).closest("li").hasClass("expanded"),n=$(this).closest("li").children("label").children("input").is(":checked");if(a)$(this).closest("li").removeClass("expanded");else if($(this).closest("li").addClass("expanded"),!s){var o=$(this).closest(".GF_Datagrid_filter_tree_panel").data("fLoadTree");o({parentId:i},GCallback(function(t){var i=t.jParent;i.data("bLoaded",!0);var s=i.children("ul");s.empty();for(var a=t.aoItems.length,o=0;a>o;o++){var i=$("<li/>");s.append(i),e._WriteTreeItem.apply(e,[i,t.aoItems[o],n])}},{jParent:$(this).closest("li")}))}},this.PreventEnter=function(t){13==t.keyCode&&(t.preventDefault(),t.stopImmediatePropagation(),$(this).change())},this._CreateBody=function(){var t=$('<div class="body"></div>'),e=$('<table cellspacing="0"></table>'),i=$("<tbody><tr><td></td></tr></tbody>");return this.m_jBody=i,t.append(e.append(i)),this.m_oOptions.appearance.max_height&&t.addClass("scrollable").css("max-height",this.m_oOptions.appearance.max_height),t},this._CreateAdditionalRows=function(){var t=$('<div class="additional_rows"></div>'),e=$('<table cellspacing="0"></table>'),i=$("<tbody><tr><td></td></tr></tbody>");return this.m_jAdditionalRows=i,t.append(e.append(i)),t},this._CreateFooter=function(){var t=$('<div class="footer"></div>');if(this.m_jFooter=t,this.m_oOptions.appearance.column_select){var e=$('<p class="selected-records"> '+GF_Datagrid.Language.selected_records+' <span class="GF_Datagrid_selected_records">0</span> <img class="GF_Datagrid_clear_selection" src="'+GF_Datagrid.Files.clear_selection_icon+'" title="'+GF_Datagrid.Language.clear_selection+'" alt="('+GF_Datagrid.Language.clear_selection+')" style="display: none;"/></p>');e.prepend(this._WriteGroupActions()),t.append(e)}var i=$('<p class="pages">'+GF_Datagrid.Language.choose_page+" </p>");i.append('<img class="GF_Datagrid_go_to_first" src="'+GF_Datagrid.Files.first_page_icon+'" alt="('+GF_Datagrid.Language.go_to_first_page+')" title="'+GF_Datagrid.Language.go_to_first_page+'"/>'),i.append('<img class="GF_Datagrid_go_to_prev" src="'+GF_Datagrid.Files.prev_page_icon+'" alt="('+GF_Datagrid.Language.go_to_prev_page+')" title="'+GF_Datagrid.Language.go_to_prev_page+'"/>'),i.append('<input type="text" value="1" class="GF_Datagrid_page"/>'),i.append('<img class="GF_Datagrid_go_to_next" src="'+GF_Datagrid.Files.next_page_icon+'" alt="('+GF_Datagrid.Language.go_to_next_page+')" title="'+GF_Datagrid.Language.go_to_next_page+'"/>'),i.append('<img class="GF_Datagrid_go_to_last" src="'+GF_Datagrid.Files.last_page_icon+'" alt="('+GF_Datagrid.Language.go_to_last_page+')" title="'+GF_Datagrid.Language.go_to_last_page+'"/>'),t.append(i);var s=$('<p class="records-shown">'+GF_Datagrid.Language.records_shown+' <span class="GF_Datagrid_records_from">0</span> - <span class="GF_Datagrid_records_to">0</span> '+GF_Datagrid.Language.out_of+' <span class="GF_Datagrid_records_total">0</span></p>');return!this.m_oOptions.appearance.column_select&&s.addClass("to-left"),t.append(s),t},this._CreateModifyColumnsDialog=function(){var t=$("<div></div>");t.attr("id","GF_Modify_Columns_Datagrid_"+this.m_iId),t.css("display","none"),t.addClass("GF_Datagrid_Modify_columns");var e=$("<ul></ul>");for(var i in this.m_aiColumnsOrder){var s=this.m_aoColumns[this.m_aiColumnsOrder[i]];if("_options"!=s.id&&"_select"!=s.id){var a=$('<input value="'+this.m_aiColumnsOrder[i]+'" type="checkbox" checked="checked"/>');a.click(GF.NewEventHandler(function(t){return $(this).parents("ul:first").find("input:checkbox:checked").length?!0:(t.preventDefault(),!1)})).change(this._HandleChangeColumns),e.append($('<li id="GF_Datagrid_Column_Order_'+this.m_aiColumnsOrder[i]+'">'+s.caption+"</li>").prepend(a))}}for(var i in this.m_aoColumns){var s=this.m_aoColumns[i];if(!GF.InArray(this.m_aiColumnsOrder,i)&&"_options"!=s.id&&"_select"!=s.id){var a=$('<input value="'+this.m_aiColumnsOrder[i]+'" type="checkbox"/>');a.click(GF.NewEventHandler(function(t){return $(this).parents("ul:first").find("input:checkbox:checked").length?!0:(t.preventDefault(),!1)})).change(this._HandleChangeColumns),e.append($('<li id="GF_Datagrid_Column_Order_'+i+'">'+s.caption+"</li>").prepend(a))}}return e.sortable({placeholder:"placeholder",update:this._HandleChangeColumns}),t.append(e),t.append('<p class="save"><a class="button" href="#" title="'+GF_Datagrid.Language.save_and_confirm_desc+'"><span><img src="'+GF_Datagrid.Files.save_icon+'" alt=""/>'+GF_Datagrid.Language.save_and_confirm+"</span></a></p>"),t.append('<p class="restore"><a class="button" href="#" title="'+GF_Datagrid.Language.restore_default_desc+'"><span><img src="'+GF_Datagrid.Files.make_default_icon+'" alt=""/>'+GF_Datagrid.Language.restore_default+"</span></a></p>"),t.append('<div class="shadow-l"></div>'),t.append('<div class="shadow-b"></div>'),t},this._InitializeEvents=function(){this.m_jTarget.keypress(GF.StopPropagation).keydown(GF.StopPropagation),$(document).on("click",".header thead .GF_Datagrid_Col__modify_columns a",this._HandleToggleColumns),$(document).on("click",".header thead .GF_Datagrid_Col__select input:checkbox",this._HandleToggleSelectVisible),$(document).on("click",".header thead th.sortable",this._ChangeOrder),$(document).on("click",".header tbody .GF_Datagrid_Col__retract_filters a",this.ToggleFilters),this.m_jTarget.mousemove(this._SpacerDrag).mouseup(this._SpacerDragStop),this.m_jFooter&&this.m_jFooter.length&&(this.m_jFooter.find(".GF_Datagrid_clear_selection").click(this.ClearSelection),this.m_jFooter.find(".GF_Datagrid_go_to_first").click(this._HandleGoToFirst),this.m_jFooter.find(".GF_Datagrid_go_to_prev").click(this._HandleGoToPrevious),this.m_jFooter.find(".GF_Datagrid_go_to_next").click(this._HandleGoToNext),this.m_jFooter.find(".GF_Datagrid_go_to_last").click(this._HandleGoToLast),this.m_jFooter.find(".GF_Datagrid_page").change(this._HandleGoToPage).keypress(this._HandleGoToPage)),$(document).on("click",".GF_Datagrid_Modify_columns .save a",this._HandleSaveColumns),$(document).on("click",".GF_Datagrid_Modify_columns .restore a",this._HandleRestoreColumns),$(document).on("mousedown",".GF_Datagrid_Col__select input",GF.PreventDefault)},this._InitializeRowEvents=function(t){t.find("select").GSelect(),t.click(this.SelectThisRow).mousedown(GF.PreventDefault),this.m_oOptions.context_actions.length&&t.click(this._HandleShowContextMenu).mouseout(this._HandleHideContextMenu),this.m_oOptions.event_handlers.view_row instanceof Function&&t.dblclick(this.HandleDoubleClick),t.find(".GF_Datagrid_Col__select input:checkbox").click(this._HandleCheckRowsCheckbox),t.find("input:text, select").mousedown(GF.StopPropagation).click(GF.StopPropagation).dblclick(GF.StopPropagation),t.find(".editable input").change(this.HandleEditableValueChange).keydown(this.PreventEnter),t.find(".selectable select").change(this.HandleSelectableValueChange).keydown(this.PreventEnter)},this._HandleGoToPage=GF.NewEventHandler(function(t){if(void 0!=t.keyCode&&13!=t.keyCode)return!0;var e=GF_Datagrid.GetCurrentInstance(this);return e.GoToPage(parseInt($(this).val())-1),!0}),this._HandleGoToNext=GF.NewEventHandler(function(t){var e=GF_Datagrid.GetCurrentInstance(this);e.GoToNext()}),this._HandleGoToPrevious=GF.NewEventHandler(function(t){var e=GF_Datagrid.GetCurrentInstance(this);e.GoToPrevious()}),this._HandleGoToFirst=GF.NewEventHandler(function(t){var e=GF_Datagrid.GetCurrentInstance(this);e.GoToFirst()}),this._HandleGoToLast=GF.NewEventHandler(function(t){var e=GF_Datagrid.GetCurrentInstance(this);e.GoToLast()}),this._HandleToggleColumns=GF.NewEventHandler(function(t){var e=GF_Datagrid.GetCurrentInstance(this);return e.m_jModifyColumnsDialog&&e.m_jModifyColumnsDialog.length?(e.m_jModifyColumnsDialog.slideUp(100,function(){e.m_jModifyColumnsDialog=GF.NULL,GOverlay.RemoveAll(),$(this).remove()}),$(this).closest("span").removeClass("active"),!1):(e.m_jModifyColumnsDialog=e._CreateModifyColumnsDialog(),e.m_jModifyColumnsDialog.css("left",$(this).closest("th").offset().left-221+$(this).closest("th").width()),e.m_jModifyColumnsDialog.css("top",$(this).closest("th").offset().top+$(this).closest("th").height()),e.m_jModifyColumnsDialog.GOverlay({fClick:GEventHandler(function(t){e.m_jTarget.find(".header thead .GF_Datagrid_Col__modify_columns a").click()}),fOpacity:.15}),$("body").append(e.m_jModifyColumnsDialog),e.m_jModifyColumnsDialog.slideDown(150),$(this).closest("span").addClass("active"),!1)}),this._HandleCheckRowsCheckbox=GF.NewEventHandler(function(t){var e=GF_Datagrid.GetCurrentInstance(this),i=$(this).parents("tr:first");t.stopPropagation();var s=e._GetIdFromTr(i);return e.IsSelected(s)?e.DeselectRow(s):e.SelectRow(s),!0}),this._HandleToggleSelectVisible=GF.NewEventHandler(function(t){var e=GF_Datagrid.GetCurrentInstance(this);return $(this).is(":checked")?e.SelectVisible():e.DeselectVisible(),!0}),this._HandleChangeColumns=GF.NewEventHandler(function(t){var e=$(this).parents(".GF_Datagrid_Modify_columns"),i=e.attr("id");dDg=GF_Datagrid.ReturnInstance(parseInt(i.substr(i.lastIndexOf("_")+1))),dDg.m_aiColumnsOrder=[],dDg.m_oOptions.appearance.column_select&&dDg.m_aiColumnsOrder.push(dDg.m_oColumnsLookup._select);var s=e.find("ul").sortable("toArray");for(var a in s){var n=parseInt(s[a].substr(s[a].lastIndexOf("_")+1));e.find("#GF_Datagrid_Column_Order_"+n+" input:checkbox:checked").length&&dDg.m_aiColumnsOrder.push(n)}return dDg.m_oOptions.appearance.column_options&&dDg.m_aiColumnsOrder.push(dDg.m_oColumnsLookup._options),dDg.m_oOptions.appearance.header&&dDg._WriteHeader(),dDg.m_oOptions.appearance.filter&&dDg._WriteFilters(),dDg._InitializeWidths(),dDg._InitializeSpacers(),dDg.Rewrite(),!0}),this._HandleSaveColumns=GF.NewEventHandler(function(t){var e=$(this).parents(".GF_Datagrid_Modify_columns"),i=e.attr("id");dDg=GF_Datagrid.ReturnInstance(parseInt(i.substr(i.lastIndexOf("_")+1)));var s=[];for(var a in dDg.m_aiColumnsOrder)s.push(dDg.m_aoColumns[dDg.m_aiColumnsOrder[a]].appearance.width);return dDg.m_oOptions.mechanics.save_column_modification&&(GCookie("GF_Datagrid_Columns_"+dDg.m_oOptions.id,JSON.stringify(dDg.m_aiColumnsOrder),7),GCookie("GF_Datagrid_Widths_"+dDg.m_oOptions.id,JSON.stringify(s),7)),dDg.m_jTarget.find(".header thead .GF_Datagrid_Col__modify_columns a").click(),!1}),this._HandleRestoreColumns=GF.NewEventHandler(function(t){var e=$(this).parents(".GF_Datagrid_Modify_columns"),i=e.attr("id"),s=GF_Datagrid.ReturnInstance(parseInt(i.substr(i.lastIndexOf("_")+1)));return e.slideUp("fast",function(){s.m_jModifyColumnsDialog=GF.NULL,$(this).remove()}),GOverlay.RemoveAll(),GCookie("GF_Datagrid_Columns_"+s.m_oOptions.id,null),GCookie("GF_Datagrid_Widths_"+s.m_oOptions.id,null),s._ParseColumnOptions(),s.m_oOptions.appearance.header&&s._WriteHeader(),s.m_oOptions.appearance.filter&&s._WriteFilters(),s._InitializeWidths(),s._InitializeSpacers(),s.Rewrite(),!1}),this._HandleShowContextMenu=GF.NewEventHandler(function(t){GF_ContextMenu.HideAll();var e=!1;if(this.context){var i=this.context;e=!0}else var i=this;var s=GF_Datagrid.GetCurrentInstance(i);if(!e&&!$(i).hasClass("selected"))return GF_ContextMenu.HandleHide(t),!1;var a=$(i).closest("tr").andSelf().find(".GF_Datagrid_Row_Id").text();if(s.SelectRow(a),GF.InArray(s.m_oOptions.no_actions_for_rows,a))return!1;if(s.m_oOptions.event_handlers.open_context_menu instanceof Function&&!s.m_oOptions.event_handlers.open_context_menu(s,a))return!1;var n=[];for(var o in s.m_oOptions.context_actions){var r=s.m_oOptions.context_actions[o];(r.condition==GF.NULL||"function"==typeof r.condition&&r.condition(s.GetRow(a)))&&n.push(r)}return new GF_ContextMenu.Create({id:a,parent:$(i).closest("tr"),actions:n,position:e?{left:t.pageX-16,top:t.pageY-10}:{left:t.pageX+10,top:t.pageY+3}}),!1}),this._HandleHideContextMenu=GF.NewEventHandler(function(t){return GF_ContextMenu.HandleHide(t)}),this.HandleDoubleClick=GF.NewEventHandler(function(t){var e=GF_Datagrid.GetCurrentInstance(this),i=$(this).closest("tr").andSelf().find(".GF_Datagrid_Row_Id").text();return e.m_oOptions.event_handlers.view_row instanceof Function&&e.m_oOptions.event_handlers.view_row(e.m_iId,i),!1}),this.HandleEditableValueChange=GF.NewEventHandler(function(t){var e=GF_Datagrid.GetCurrentInstance(this),i=$(this).closest("tr").andSelf().find(".GF_Datagrid_Row_Id").text();if(e.m_oOptions.event_handlers.update_row instanceof Function){var s=e.GetRow(i),a=$(this).attr("name").substring($(this).attr("name").lastIndexOf("[")+1,$(this).attr("name").length-1),n=s[a];return s[a]=$(this).val(),e.m_oOptions.event_handlers.update_row(i,s,a,n)}}),this.HandleSelectableValueChange=GF.NewEventHandler(function(t){var e=GF_Datagrid.GetCurrentInstance(this),i=$(this).closest("tr").andSelf().find(".GF_Datagrid_Row_Id").text();if(e.m_oOptions.event_handlers.update_row instanceof Function){var s=$.extend(!0,{},e.GetRow(i)),a=$(this).attr("name").substring($(this).attr("name").lastIndexOf("[")+1,$(this).attr("name").length-1),n=s[a];s[a]=$(this).find("option:selected").attr("value");var o={id:i,data:s,column:a,previous_value:n};return e.m_oOptions.event_handlers.update_row(o,GCallback(function(t){t.error&&GError(GF_Debug.Language.error_occured,t.error),e.LoadData()})),!0}}),this._NewRowEventHandler=function(t){var e=GF.NewEventHandler(function(e){var i=GF_Datagrid.GetCurrentInstance(this),s=$(this).is("tr")?$(this):$(this).parents("tr:first");if(!s.length)return GF_Debug.Warning("Datagrid's row event handler invoked neither on a TR element nor on any of its descendants. Action aborted."),!1;var a=i._GetIdFromTr(s);return e.stopImmediatePropagation(),e.preventDefault(),t(i,a)});return e},this.GF_Datagrid(t,e)},{s_dContextMenuFordDg:GF.NULL,s_sContextMenuForId:GF.NULL,s_cContextMenu:GF.NULL,SORT_DIR_ASC:1,SORT_DIR_DESC:2,ALIGN_LEFT:1,ALIGN_CENTER:2,ALIGN_RIGHT:3,FILTER_NONE:0,FILTER_INPUT:1,FILTER_BETWEEN:2,FILTER_SELECT:3,FILTER_AUTOSUGGEST:4,FILTER_TREE:5,WIDTH_AUTO:0,ACTION_EDIT:1,ACTION_DELETE:2,ACTION_VIEW:3,ACTION_DELETE_GROUP:3,RefreshAll:GF.NewSafeMethod(function(){for(var t in GF_Instance.s_aoInstances)GF_Instance.s_aoInstances[t].IsInstanceOf("GF_Datagrid")&&GF_Instance.s_aoInstances[t].LoadData()}),ProcessIncomingData:GF.NewEventHandler(function(t){void 0!=t.data_id&&GF_Instance.s_aoInstances[t.data_id]instanceof GF_Datagrid||GF_Debug.Error("The server has responded with an invalid data.<br />"+t.error);var e=GF_Instance.ReturnInstance(t.data_id);e._ProcessData(t)}),Redirect:GF.NewEventHandler(function(t){window.location.href=t})}),GF_Datagrid_Config=GF_Config.GF_Extend("GF_Datagrid_Config",function(t){return this.GF_Datagrid_Config=GF.NewConstructor(function(t){this.id=GF.NULL,this.appearance={header:!0,filter:!0,footer:!0,column_select:!0,column_options:!0,max_height:0},this.mechanics={rows_per_page:50,key:GF.NULL,default_sorting:GF.NULL,right_click_menu:!1,auto_suggest_delay:500,auto_suggest_min_length:1,auto_suggest_suggestions:5,only_one_selected:!1,no_column_modification:!1,no_column_resizing:!1,create_input:!1,save_column_modification:!0,persistent:!0},this.event_handlers={load:GF.NULL,process:GF.NULL,select:GF.NULL,deselect:GF.NULL,click_row:GF.NULL,view_row:GF.NULL,selection_changed:GF.NULL,delete_row:GF.NULL,edit_row:GF.NULL,update_row:GF.NULL,delete_group:GF.NULL,open_context_menu:GF.NULL,loaded:GF.NULL},this.external_indicators={rows_from:GF.NULL,rows_to:GF.NULL,total_rows:GF.NULL,page:GF.NULL,total_pages:GF.NULL},this.columns=[],this.row_actions=[],this.group_actions=[],this.context_actions=[],this.no_actions_for_rows=[],this.additional_filters=[],this._Process(t)}),this._PostProcess=function(){this.mechanics.key==GF.NULL&&(this.mechanics.key=this.columns[0].id),this.mechanics.default_sorting==GF.NULL&&(this.mechanics.default_sorting=this.mechanics.key)},this.GF_Datagrid_Config(t)}),GF_Ajax_Request=function(t,e,i){return $.ajax({type:"POST",url:t,data:e,success:i,dataType:"json"})},GF_Datagrid_Column=GF_Config.GF_Extend("GF_Datagrid_Column",function(t){return this.GF_Datagrid_Column=GF.NewConstructor(function(t){this.id=GF.NULL,this.caption=GF.NULL,this.editable=!1,this.selectable=!1,this.appearance={visible:!0,width:GF_Datagrid.WIDTH_AUTO,align:GF_Datagrid.ALIGN_CENTER,no_title:!1},this.sorting={allowed:!0,default_order:GF_Datagrid.SORT_DIR_ASC},this.filter={type:GF_Datagrid.FILTER_NONE,filtered_column:GF.NULL,source:GF.NULL,options:[],load_children:GF.NULL},this._Process(t)}),this.GF_Datagrid_Column(t)}),GF_Datagrid_Row=GF_Config.GF_Extend("GF_Datagrid_Row",function(t){return this.GF_Datagrid_Row=GF.NewConstructor(function(t){this.id=GF.NULL,this.key="id",this.className="",this.caption="",this.source=GF.NULL,this._Process(t)}),this.GF_Datagrid_Row(t)}),GF_Action=GF_Config.GF_Extend("GF_Action",function(t){return this.GF_Action=GF.NewConstructor(function(t){this.img=GF.NULL,this.caption=GF.NULL,this.action=GF.NULL,this.values={},this.parameter=GF.NULL,this.condition=GF.NULL,this._Process(t)}),this.GF_Action(t)}),GF_Slider=GF_Instance.GF_Extend("GF_Slider",function(t,e){return this.GF_Slider,this.m_oOptions,this.m_jSlider,this.p_iValue,this.p_iMin,this.p_iMax,this.GF_Slider=GF.NewConstructor(function(t,e){var i={min:0,max:200,range_min:0,range_max:200,value:0,event_handlers:{drag_start:GF.NULL,drag_end:GF.NULL,change:GF.NULL}};this.m_oOptions=$.extend(i,e),this.p_iMin=this.m_oOptions.min,this.p_iMax=this.m_oOptions.max,this._InitSlider(),this.p_iValue=parseInt(this.m_jSlider.slider("value")),this.UpdateIndicators()}),this._InitSlider=function(){this.m_jSlider=$("<div/>"),this.m_jInput=$('<input type="text"/>'),this.m_jInput.change(this._OnInputChange),this.m_jTarget.append(this.m_jSlider),this.m_jTarget.append($('<div class="input"/>').append($("<span/>").append(this.m_jInput))),this.m_jSlider.slider({range:"min",min:this.m_oOptions.range_min,max:this.m_oOptions.range_max,value:this.m_oOptions.value,slide:this._OnSlide,start:this._OnStart,stop:this._OnStop})},this._OnSlide=GF.NewSafeMethod(function(t,e){var i=GF_Slider.GetCurrentInstance(this),s=i.p_iValue,a=i._Validate(parseInt(e.value));return i.p_iValue=a,i.UpdateIndicators(),a!=s&&i._InvokeEvent("change",{previous_value:s,value:a}),a!=parseInt(e.value)?(i.m_jSlider.slider("value",i.p_iValue),!1):!0}),this._OnStart=GF.NewSafeMethod(function(t,e){var i=GF_Slider.GetCurrentInstance(this);return i._InvokeEvent("drag_start",{value:i.p_iValue}),!0}),this._OnStop=GF.NewSafeMethod(function(t,e){var i=GF_Slider.GetCurrentInstance(this);return i._InvokeEvent("drag_end",{value:i.p_iValue}),!0}),this._OnInputChange=GF.NewEventHandler(function(t){var e=GF_Slider.GetCurrentInstance(this);e.SetValue($(this).val())}),this.UpdateIndicators=function(){this.m_jInput.val(this.p_iValue+"%")},this.SetValue=GF.NewSafeMethod(function(t){if(t=parseInt(t),isNaN(t))return this.UpdateIndicators(),!1;var e=this.p_iValue;return this.p_iValue=this._Validate(t),this.m_jSlider.slider("value",this.p_iValue),this.UpdateIndicators(),this._InvokeEvent("change",{previous_value:e,value:this.p_iValue}),!0}),this._Validate=function(t){return Math.max(this.p_iMin,Math.min(this.p_iMax,t))},this._InvokeEvent=function(t,e){void 0!=this.m_oOptions.event_handlers&&void 0!=this.m_oOptions.event_handlers[t]&&this.m_oOptions.event_handlers[t]instanceof Function&&this.m_oOptions.event_handlers[t].call(this.m_jTarget.get(0),e)},this.GF_Slider(t,e)},{}),GF_Datagrid.Language={options:'<span class="hidden">Opcje</span>',select_all:"Zaznacz wszystkie",modify_columns:"ZmieЕ„ ustawienia kolumn",retract_filters:"ZwiЕ„ filtry",expand_filters:"RozwiЕ„ filtry",from:"From",to:"To",delete_group:"UsuЕ„ wybrane rekordy",delete_row:"Delete",edit_row:"Edit",view_row:"WyЕ›wietl rekord",records_shown:"Records:",out_of:"of",choose_page:"Page:",go_to_prev_page:"PrzejdЕє do poprzedniej strony",go_to_next_page:"PrzejdЕє do nastД™pnej strony",go_to_first_page:"PrzejdЕє do pierwszej strony",go_to_last_page:"PrzejdЕє do ostatniej strony",selected_records:"Wybranych:",clear_selection:"Anuluj wybГіr",confirm:"OK",restore_default:"Restore defaults",restore_default_desc:"PrzywrГіД‡ domyЕ›lne ustawienia kolumn dla tego moduЕ‚u",save_and_confirm:"Save settings",save_and_confirm_desc:"ZapamiД™taj ustawienia i szerokoЕ›ci kolumn, aby staЕ‚y siД™ domyЕ›lnymi dla tego moduЕ‚u",no_rows_selected:"Nie wybrano Ејadnego wiersza.",not_all_shown:"Uwaga! Zastosowano filtracjД™. Ukrytych rekordГіw: ",filter_tree_expand:"Choose",filter_tree_retract:"Collapse",filter_tree_cancel:"Remove from filter",filter_tree_cancel_all:"Reset",filter_tree_empty:"(brak filtracji)"},GF_Datagrid.Files={modify_columns_icon:GCore.DESIGN_PATH+"images/datagrid/modify-columns.png",retract_filters_icon:GCore.DESIGN_PATH+"images/datagrid/filter-retract.png",expand_filters_icon:GCore.DESIGN_PATH+"images/datagrid/filter-expand.png",order_asc:GCore.DESIGN_PATH+"images/datagrid/sort-asc.png",order_desc:GCore.DESIGN_PATH+"images/datagrid/sort-desc.png",delete_group_icon:GCore.DESIGN_PATH+"images/icons/datagrid/delete.png",delete_row_icon:GCore.DESIGN_PATH+"images/icons/datagrid/delete.png",edit_row_icon:GCore.DESIGN_PATH+"images/icons/datagrid/edit.png",view_row_icon:GCore.DESIGN_PATH+"images/icons/datagrid/details.png",first_page_icon:GCore.DESIGN_PATH+"images/datagrid/page-first.png",prev_page_icon:GCore.DESIGN_PATH+"images/datagrid/page-prev.png",next_page_icon:GCore.DESIGN_PATH+"images/datagrid/page-next.png",last_page_icon:GCore.DESIGN_PATH+"images/datagrid/page-last.png",clear_selection_icon:GCore.DESIGN_PATH+"images/datagrid/clear-selection.png",save_icon:GCore.DESIGN_PATH+"images/icons/datagrid/save.png",make_default_icon:GCore.DESIGN_PATH+"images/icons/datagrid/make-default.png",warning_icon:GCore.DESIGN_PATH+"images/datagrid/warning.png"},$(document).ready(function(){$(".block").GBlock(),$(".box").GBox(),$("select").GSelect(),$("#message-bar").GMessageBar(),$(".simple-stats .tabs").tabs({fx:{opacity:"toggle",duration:75}}),$(".scrollable-tabs").GScrollableTabs(),GCore.Init(),$(".order-notes").tabs(),$(".sticky-progress").GSticky(),$("#navigation > li > ul > li > ul > li.active").parent().parent().parent().parent().addClass("active"),$("#navigation > li > ul > li.active").parent().parent().addClass("active"),$("#navigation > li > ul > li.active").parent().addClass("active"),$("#navigation li").hoverIntent({interval:100,over:function(){$("> ul",this).addClass("down").slideDown()},timeout:300,out:function(){$("> ul",this).removeClass("down").slideUp()}}),$(".GF_Datagrid_Col_createdAt .from").datepicker({dateFormat:"yy-mm-dd 00:00:00"}),$(".GF_Datagrid_Col_createdAt .to").datepicker({dateFormat:"yy-mm-dd 23:59:59"}),$("#change-context").change(function(){GF_Ajax_Request(Routing.generate("admin.shop.change_context",{id:$(this).val()}),{},function(t){DataGrid instanceof GF_Datagrid?DataGrid.LoadData():window.location.reload(!1)})})});